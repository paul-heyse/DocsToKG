# 1. Module: cli

This reference documents the DocsToKG module ``DocsToKG.OntologyDownload.cli``.

## 1. Overview

Command-line orchestration for DocsToKG OntologyDownload.

## 2. Functions

### `_build_parser()`

Configure the top-level CLI parser and subcommands.

Returns:
Argument parser providing the consolidated ``ontofetch`` CLI.

### `_parse_target_formats(value)`

Normalize comma-separated target format strings.

Args:
value: Raw CLI argument possibly containing comma-delimited formats.

Returns:
List of stripped format identifiers, or an empty list when no formats are supplied.

### `_parse_positive_int(value)`

Parse CLI argument ensuring it is a positive integer.

Args:
value: Textual representation of a positive integer.

Returns:
Parsed positive integer value.

Raises:
argparse.ArgumentTypeError: If ``value`` is not a positive integer.

### `_parse_allowed_hosts(value)`

Split comma-delimited host allowlist argument into unique entries.

Args:
value: Raw CLI argument containing comma-delimited hostnames.

Returns:
List of unique hostnames preserving input order.

### `_normalize_plan_args(args)`

Ensure ``plan`` command defaults to the ``run`` subcommand when omitted.

Args:
args: Original CLI argument vector.

Returns:
Updated argument list with explicit subcommands injected as needed.

### `_parse_since_arg(value)`

Parse ``YYYY-MM-DD`` strings into timezone-aware datetimes.

Args:
value: Date string provided on the command line.

Returns:
Timezone-aware datetime instance aligned to UTC.

Raises:
argparse.ArgumentTypeError: If ``value`` is not a valid date.

### `_parse_since(value)`

Parse optional date input into timezone-aware datetimes.

Args:
value: Either a string date or a pre-parsed datetime.

Returns:
Normalized datetime in UTC, or ``None`` when not supplied.

### `_apply_cli_overrides(config, args)`

Mutate resolved configuration based on CLI override arguments.

Args:
config: Resolved configuration subject to mutation.
args: Parsed CLI namespace containing override values.

### `_resolve_specs_from_args(args, base_config)`

Return configuration and fetch specifications derived from CLI arguments.

### `_handle_pull(args, base_config)`

Execute the ``pull`` subcommand workflow.

### `_handle_plan(args, base_config)`

Resolve plans without executing downloads.

### `_handle_plan_diff(args, base_config)`

Compare current plan output against a baseline plan file.

### `_handle_plugins(args)`

Return plugin inventory for the requested kind.

### `_handle_prune(args, logger)`

Delete surplus ontology versions based on ``--keep`` and age filters.

### `_read_api_key_status(path)`

Return diagnostic metadata for an API key file.

Args:
path: Target file path to inspect.

Returns:
Mapping including the path, whether it exists, configuration status, and
any error encountered while reading the contents.

### `_doctor_report()`

Collect diagnostic information for the ``doctor`` command.

Returns:
Mapping capturing disk, dependency, network, and configuration status.

### `_apply_doctor_fixes(report)`

Attempt to remediate common doctor issues and return action notes.

### `_print_doctor_report(report)`

Render human-readable diagnostics from :func:`_doctor_report`.

Args:
report: Diagnostics mapping generated by :func:`_doctor_report`.

### `_handle_show(args)`

Display ontology manifest information for the ``show`` command.

Args:
args: Parsed CLI arguments including ontology identifier and output format.

Returns:
None

Raises:
ConfigError: When the manifest cannot be located.

### `_selected_validators(args)`

Determine which validators should execute based on CLI flags.

Args:
args: Parsed CLI arguments for the ``validate`` command.

Returns:
Sequence containing validator names in execution order.

### `_handle_validate(args, config)`

Run validators for a previously downloaded ontology.

Args:
args: Parsed CLI arguments specifying ontology ID, version, and output format.
config: Resolved configuration supplying validator defaults.

Returns:
Mapping of validator names to their structured result payloads.

Raises:
ConfigError: If the manifest or downloaded artifacts cannot be located.

### `_handle_init(path)`

Create a starter ``sources.yaml`` file for new installations.

Args:
path: Destination path for the generated configuration template.

Raises:
ConfigError: If the target file already exists.

### `_handle_config_validate(path)`

Validate a configuration file and return a summary report.

Args:
path: Filesystem path to the configuration file under validation.

Returns:
Dictionary describing validation status, ontology count, and file path.

### `_emit_batch_failure(exc, args)`

Print a concise error message and optionally serialize partial results.

### `cli_main(argv)`

Entry point for the ontology downloader CLI.

Args:
argv: Optional argument vector supplied for testing or scripting.

Returns:
Process exit code indicating success (`0`) or failure.

Raises:
ConfigError: If configuration files are invalid or unsafe to overwrite.
OntologyDownloadError: If download or validation operations fail.

### `apply_resolver_override(specs)`

Force all ``specs`` to use the resolver override when one is provided.

Args:
specs: Iterable of fetch specifications to adjust.

Returns:
List[FetchSpec]: Normalised fetch specs that honour the override selection.
