

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>1. Module: storage &mdash; DocsToKG 1.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/css/custom.css" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=8d563738"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            DocsToKG
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../01-overview/index.html">1. Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../02-setup/index.html">1. Setup Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../03-architecture/index.html">1. Architecture Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html">1. API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../05-development/index.html">1. Development Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../06-operations/index.html">1. Operations Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../07-reference/index.html">1. Technical Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">DocsToKG</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">1. Module: storage</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/04-api/DocsToKG.OntologyDownload.storage.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="module-storage">
<h1>1. Module: storage<a class="headerlink" href="#module-storage" title="Link to this heading"></a></h1>
<p>This reference documents the DocsToKG module <code class="docutils literal notranslate"><span class="pre">DocsToKG.OntologyDownload.storage</span></code>.</p>
<p>Storage backends for ontology artifacts.</p>
<p>The refactored ontology downloader expects durable, versioned storage that can
support dry-run planning, streaming normalization, and version pruning. This
module centralizes local and optional remote (fsspec) storage implementations,
ensuring that metadata such as latest version markers and reclaimed space
reports remain consistent with the openspec storage management requirements.</p>
<section id="functions">
<h2>1. Functions<a class="headerlink" href="#functions" title="Link to this heading"></a></h2>
<section id="safe-identifiers-ontology-id-version">
<h3><code class="docutils literal notranslate"><span class="pre">_safe_identifiers(ontology_id,</span> <span class="pre">version)</span></code><a class="headerlink" href="#safe-identifiers-ontology-id-version" title="Link to this heading"></a></h3>
<p>Return identifiers sanitized for filesystem usage.</p>
</section>
<section id="directory-size-path">
<h3><code class="docutils literal notranslate"><span class="pre">_directory_size(path)</span></code><a class="headerlink" href="#directory-size-path" title="Link to this heading"></a></h3>
<p>Return the total size in bytes for all regular files under <code class="docutils literal notranslate"><span class="pre">path</span></code>.</p>
</section>
<section id="get-storage-backend">
<h3><code class="docutils literal notranslate"><span class="pre">get_storage_backend()</span></code><a class="headerlink" href="#get-storage-backend" title="Link to this heading"></a></h3>
<p>Instantiate the storage backend based on environment configuration.</p>
<p>Args:
None</p>
<p>Returns:
Storage backend instance selected according to <code class="docutils literal notranslate"><span class="pre">ONTOFETCH_STORAGE_URL</span></code>.</p>
</section>
<section id="prepare-version-self-ontology-id-version">
<h3><code class="docutils literal notranslate"><span class="pre">prepare_version(self,</span> <span class="pre">ontology_id,</span> <span class="pre">version)</span></code><a class="headerlink" href="#prepare-version-self-ontology-id-version" title="Link to this heading"></a></h3>
<p>Return a working directory prepared for the given ontology version.</p>
<p>Args:
ontology_id: Identifier of the ontology being downloaded.
version: Version string representing the in-flight download.</p>
<p>Returns:
Path to a freshly prepared directory tree ready for population.</p>
</section>
<section id="ensure-local-version-self-ontology-id-version">
<h3><code class="docutils literal notranslate"><span class="pre">ensure_local_version(self,</span> <span class="pre">ontology_id,</span> <span class="pre">version)</span></code><a class="headerlink" href="#ensure-local-version-self-ontology-id-version" title="Link to this heading"></a></h3>
<p>Ensure the requested version is present locally and return its path.</p>
<p>Args:
ontology_id: Identifier whose version must be present.
version: Version string that should exist on local storage.</p>
<p>Returns:
Path to the local directory containing the requested version.</p>
</section>
<section id="available-versions-self-ontology-id">
<h3><code class="docutils literal notranslate"><span class="pre">available_versions(self,</span> <span class="pre">ontology_id)</span></code><a class="headerlink" href="#available-versions-self-ontology-id" title="Link to this heading"></a></h3>
<p>Return sorted version identifiers currently stored for an ontology.</p>
<p>Args:
ontology_id: Identifier whose known versions are requested.</p>
<p>Returns:
Sorted list of version strings recognised by the backend.</p>
</section>
<section id="available-ontologies-self">
<h3><code class="docutils literal notranslate"><span class="pre">available_ontologies(self)</span></code><a class="headerlink" href="#available-ontologies-self" title="Link to this heading"></a></h3>
<p>Return sorted ontology identifiers known to the backend.</p>
<p>Args:
None</p>
<p>Returns:
Alphabetically sorted list of ontology identifiers the backend can
service.</p>
</section>
<section id="finalize-version-self-ontology-id-version-local-dir">
<h3><code class="docutils literal notranslate"><span class="pre">finalize_version(self,</span> <span class="pre">ontology_id,</span> <span class="pre">version,</span> <span class="pre">local_dir)</span></code><a class="headerlink" href="#finalize-version-self-ontology-id-version-local-dir" title="Link to this heading"></a></h3>
<p>Persist the working directory after validation succeeds.</p>
<p>Args:
ontology_id: Identifier of the ontology that completed processing.
version: Version string associated with the finalized artifacts.
local_dir: Directory containing the validated ontology payload.</p>
<p>Returns:
None.</p>
</section>
<section id="version-path-self-ontology-id-version">
<h3><code class="docutils literal notranslate"><span class="pre">version_path(self,</span> <span class="pre">ontology_id,</span> <span class="pre">version)</span></code><a class="headerlink" href="#version-path-self-ontology-id-version" title="Link to this heading"></a></h3>
<p>Return the canonical storage path for <code class="docutils literal notranslate"><span class="pre">ontology_id</span></code>/<code class="docutils literal notranslate"><span class="pre">version</span></code>.</p>
<p>Args:
ontology_id: Identifier of the ontology being queried.
version: Version string for which a canonical path is needed.</p>
<p>Returns:
Path pointing to the storage location for the requested version.</p>
</section>
<section id="delete-version-self-ontology-id-version">
<h3><code class="docutils literal notranslate"><span class="pre">delete_version(self,</span> <span class="pre">ontology_id,</span> <span class="pre">version)</span></code><a class="headerlink" href="#delete-version-self-ontology-id-version" title="Link to this heading"></a></h3>
<p>Delete a stored version returning the number of bytes reclaimed.</p>
<p>Args:
ontology_id: Identifier whose version should be removed.
version: Version string targeted for deletion.</p>
<p>Returns:
Number of bytes reclaimed by removing the stored version.</p>
<p>Raises:
OSError: If the underlying storage provider fails to delete data.</p>
</section>
<section id="set-latest-version-self-ontology-id-version">
<h3><code class="docutils literal notranslate"><span class="pre">set_latest_version(self,</span> <span class="pre">ontology_id,</span> <span class="pre">version)</span></code><a class="headerlink" href="#set-latest-version-self-ontology-id-version" title="Link to this heading"></a></h3>
<p>Update the latest version marker for operators and CLI tooling.</p>
<p>Args:
ontology_id: Identifier whose latest marker requires updating.
version: Version string to record as the active release.</p>
<p>Returns:
None.</p>
</section>
<section id="version-dir-self-ontology-id-version">
<h3><code class="docutils literal notranslate"><span class="pre">_version_dir(self,</span> <span class="pre">ontology_id,</span> <span class="pre">version)</span></code><a class="headerlink" href="#version-dir-self-ontology-id-version" title="Link to this heading"></a></h3>
<p><em>No documentation available.</em></p>
</section>
<section id="id1">
<h3><code class="docutils literal notranslate"><span class="pre">prepare_version(self,</span> <span class="pre">ontology_id,</span> <span class="pre">version)</span></code><a class="headerlink" href="#id1" title="Link to this heading"></a></h3>
<p>Create the working directory structure for a download run.</p>
<p>Args:
ontology_id: Identifier of the ontology being processed.
version: Canonical version string for the ontology.</p>
<p>Returns:
Path to the prepared base directory containing <code class="docutils literal notranslate"><span class="pre">original</span></code>,
<code class="docutils literal notranslate"><span class="pre">normalized</span></code>, and <code class="docutils literal notranslate"><span class="pre">validation</span></code> subdirectories.</p>
</section>
<section id="id2">
<h3><code class="docutils literal notranslate"><span class="pre">ensure_local_version(self,</span> <span class="pre">ontology_id,</span> <span class="pre">version)</span></code><a class="headerlink" href="#id2" title="Link to this heading"></a></h3>
<p>Ensure a local workspace exists for <code class="docutils literal notranslate"><span class="pre">ontology_id</span></code>/<code class="docutils literal notranslate"><span class="pre">version</span></code>.</p>
<p>Args:
ontology_id: Identifier whose workspace must exist.
version: Version string that should map to a directory.</p>
<p>Returns:
Path to the local directory for the ontology version.</p>
</section>
<section id="id3">
<h3><code class="docutils literal notranslate"><span class="pre">available_versions(self,</span> <span class="pre">ontology_id)</span></code><a class="headerlink" href="#id3" title="Link to this heading"></a></h3>
<p>Return sorted versions already present for an ontology.</p>
<p>Args:
ontology_id: Identifier whose stored versions should be listed.</p>
<p>Returns:
Sorted list of version strings found under the storage root.</p>
</section>
<section id="id4">
<h3><code class="docutils literal notranslate"><span class="pre">available_ontologies(self)</span></code><a class="headerlink" href="#id4" title="Link to this heading"></a></h3>
<p>Return ontology identifiers discovered under <code class="docutils literal notranslate"><span class="pre">root</span></code>.</p>
<p>Args:
None</p>
<p>Returns:
Sorted list of ontology identifiers available locally.</p>
</section>
<section id="id5">
<h3><code class="docutils literal notranslate"><span class="pre">finalize_version(self,</span> <span class="pre">ontology_id,</span> <span class="pre">version,</span> <span class="pre">local_dir)</span></code><a class="headerlink" href="#id5" title="Link to this heading"></a></h3>
<p>Finalize a local version directory (no-op for purely local storage).</p>
<p>Args:
ontology_id: Identifier that finished processing.
version: Version string associated with the processed ontology.
local_dir: Directory containing the ready-to-serve ontology.</p>
<p>Returns:
None.</p>
</section>
<section id="id6">
<h3><code class="docutils literal notranslate"><span class="pre">version_path(self,</span> <span class="pre">ontology_id,</span> <span class="pre">version)</span></code><a class="headerlink" href="#id6" title="Link to this heading"></a></h3>
<p>Return the local storage directory for the requested version.</p>
<p>Args:
ontology_id: Identifier being queried.
version: Version string whose storage path is needed.</p>
<p>Returns:
Path pointing to the stored ontology version.</p>
</section>
<section id="id7">
<h3><code class="docutils literal notranslate"><span class="pre">delete_version(self,</span> <span class="pre">ontology_id,</span> <span class="pre">version)</span></code><a class="headerlink" href="#id7" title="Link to this heading"></a></h3>
<p>Delete a stored ontology version returning reclaimed bytes.</p>
<p>Args:
ontology_id: Identifier whose stored version should be removed.
version: Version string targeted for deletion.</p>
<p>Returns:
Number of bytes reclaimed by removing the version directory.</p>
<p>Raises:
OSError: Propagated if filesystem deletion fails.</p>
</section>
<section id="id8">
<h3><code class="docutils literal notranslate"><span class="pre">set_latest_version(self,</span> <span class="pre">ontology_id,</span> <span class="pre">version)</span></code><a class="headerlink" href="#id8" title="Link to this heading"></a></h3>
<p>Update symlink and marker file indicating the latest version.</p>
<p>Args:
ontology_id: Identifier whose latest marker should be updated.
version: Version string to record as the latest processed build.</p>
<p>Returns:
None.</p>
</section>
<section id="remote-version-path-self-ontology-id-version">
<h3><code class="docutils literal notranslate"><span class="pre">_remote_version_path(self,</span> <span class="pre">ontology_id,</span> <span class="pre">version)</span></code><a class="headerlink" href="#remote-version-path-self-ontology-id-version" title="Link to this heading"></a></h3>
<p><em>No documentation available.</em></p>
</section>
<section id="id9">
<h3><code class="docutils literal notranslate"><span class="pre">available_versions(self,</span> <span class="pre">ontology_id)</span></code><a class="headerlink" href="#id9" title="Link to this heading"></a></h3>
<p>Return versions aggregated from local cache and remote storage.</p>
<p>Args:
ontology_id: Identifier whose version catalogue is required.</p>
<p>Returns:
Sorted list combining local and remote version identifiers.</p>
</section>
<section id="id10">
<h3><code class="docutils literal notranslate"><span class="pre">available_ontologies(self)</span></code><a class="headerlink" href="#id10" title="Link to this heading"></a></h3>
<p>Return ontology identifiers available locally or remotely.</p>
<p>Args:
None</p>
<p>Returns:
Sorted set union of local and remote ontology identifiers.</p>
</section>
<section id="id11">
<h3><code class="docutils literal notranslate"><span class="pre">ensure_local_version(self,</span> <span class="pre">ontology_id,</span> <span class="pre">version)</span></code><a class="headerlink" href="#id11" title="Link to this heading"></a></h3>
<p>Mirror a remote ontology version into the local cache when absent.</p>
<p>Args:
ontology_id: Identifier whose version should exist locally.
version: Version string to ensure within the local cache.</p>
<p>Returns:
Path to the local directory containing the requested version.</p>
</section>
<section id="id12">
<h3><code class="docutils literal notranslate"><span class="pre">finalize_version(self,</span> <span class="pre">ontology_id,</span> <span class="pre">version,</span> <span class="pre">local_dir)</span></code><a class="headerlink" href="#id12" title="Link to this heading"></a></h3>
<p>Upload the finalized local directory to the remote store.</p>
<p>Args:
ontology_id: Identifier of the ontology that has completed processing.
version: Version string associated with the finalised ontology.
local_dir: Directory containing the validated ontology payload.</p>
<p>Returns:
None.</p>
</section>
<section id="id13">
<h3><code class="docutils literal notranslate"><span class="pre">delete_version(self,</span> <span class="pre">ontology_id,</span> <span class="pre">version)</span></code><a class="headerlink" href="#id13" title="Link to this heading"></a></h3>
<p>Delete both local and remote copies of a stored version.</p>
<p>Args:
ontology_id: Identifier whose stored version should be deleted.
version: Version string targeted for deletion.</p>
<p>Returns:
Total bytes reclaimed across local and remote storage.</p>
<p>Raises:
OSError: Propagated if remote deletion fails irrecoverably.</p>
</section>
</section>
<section id="classes">
<h2>2. Classes<a class="headerlink" href="#classes" title="Link to this heading"></a></h2>
<section id="storagebackend">
<h3><code class="docutils literal notranslate"><span class="pre">StorageBackend</span></code><a class="headerlink" href="#storagebackend" title="Link to this heading"></a></h3>
<p>Protocol describing the operations required by the downloader pipeline.</p>
<p>Attributes:
root_path: Canonical base path that implementations expose for disk
storage.  Remote-only backends can synthesize this attribute for
instrumentation purposes.</p>
<p>Examples:</p>
<blockquote>
<div><blockquote>
<div><blockquote>
<div><p>class MemoryBackend(StorageBackend):
…     root_path = Path(“/tmp”)  # pragma: no cover - illustrative stub
…     def prepare_version(self, ontology_id: str, version: str) -&gt; Path:
…         …</p>
</div></blockquote>
</div></blockquote>
</div></blockquote>
</section>
<section id="localstoragebackend">
<h3><code class="docutils literal notranslate"><span class="pre">LocalStorageBackend</span></code><a class="headerlink" href="#localstoragebackend" title="Link to this heading"></a></h3>
<p>Storage backend that keeps ontology artifacts on the local filesystem.</p>
<p>Attributes:
root: Base directory that stores ontology versions grouped by identifier.</p>
<p>Examples:</p>
<blockquote>
<div><blockquote>
<div><blockquote>
<div><p>backend = LocalStorageBackend(LOCAL_ONTOLOGY_DIR)
backend.available_ontologies()
[]</p>
</div></blockquote>
</div></blockquote>
</div></blockquote>
</section>
<section id="fsspecstoragebackend">
<h3><code class="docutils literal notranslate"><span class="pre">FsspecStorageBackend</span></code><a class="headerlink" href="#fsspecstoragebackend" title="Link to this heading"></a></h3>
<p>Hybrid storage backend that mirrors artifacts to an fsspec location.</p>
<p>Attributes:
fs: <code class="docutils literal notranslate"><span class="pre">fsspec</span></code> filesystem instance used for remote operations.
base_path: Root path within the remote filesystem where artefacts live.</p>
<p>Examples:</p>
<blockquote>
<div><blockquote>
<div><blockquote>
<div><p>backend = FsspecStorageBackend(“memory://ontologies”)  # doctest: +SKIP
backend.available_ontologies()  # doctest: +SKIP
[]</p>
</div></blockquote>
</div></blockquote>
</div></blockquote>
</section>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, DocsToKG Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>