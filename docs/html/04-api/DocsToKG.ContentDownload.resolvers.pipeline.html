

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>1. Module: pipeline &mdash; DocsToKG 1.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/css/custom.css" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=8d563738"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            DocsToKG
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../01-overview/index.html">1. Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../02-setup/index.html">1. Setup Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../03-architecture/index.html">1. Architecture Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html">1. API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../05-development/index.html">1. Development Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../06-operations/index.html">1. Operations Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../07-reference/index.html">1. Technical Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">DocsToKG</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">1. Module: pipeline</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/04-api/DocsToKG.ContentDownload.resolvers.pipeline.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="module-pipeline">
<h1>1. Module: pipeline<a class="headerlink" href="#module-pipeline" title="Link to this heading"></a></h1>
<p>This reference documents the DocsToKG module <code class="docutils literal notranslate"><span class="pre">DocsToKG.ContentDownload.pipeline.pipeline</span></code>.</p>
<p>Resolver Pipeline Execution Engine</p>
<p>This module coordinates the execution of resolver providers that discover
downloadable artefacts for scholarly works. It encapsulates sequential and
concurrent strategies, rate limiting, duplicate detection, and callback hooks
for logging and metrics collection.</p>
<p>Key Features:</p>
<ul class="simple">
<li><p>Sequential and concurrent resolver scheduling with configurable concurrency.</p></li>
<li><p>Rate-limiting enforcement, optional domain-level throttling, and HEAD preflight checks.</p></li>
<li><p>State tracking for seen URLs, global deduplication, HTML fallbacks, and failure metrics.</p></li>
</ul>
<p>Usage:
from DocsToKG.ContentDownload.pipeline.pipeline import ResolverPipeline</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>pipeline = ResolverPipeline(
    resolvers=[],
    config=ResolverConfig(),
    download_func=lambda *args, **kwargs: DownloadOutcome(&quot;miss&quot;),
    logger=lambda record: None,
    metrics=ResolverMetrics(),
)
</pre></div>
</div>
<section id="functions">
<h2>1. Functions<a class="headerlink" href="#functions" title="Link to this heading"></a></h2>
<section id="request-with-retries-session-method-url">
<h3><code class="docutils literal notranslate"><span class="pre">request_with_retries(session,</span> <span class="pre">method,</span> <span class="pre">url)</span></code><a class="headerlink" href="#request-with-retries-session-method-url" title="Link to this heading"></a></h3>
<p>Proxy to :func:<code class="docutils literal notranslate"><span class="pre">DocsToKG.ContentDownload.networking.request_with_retries</span></code>.</p>
<p>The indirection keeps this module compatible with unit tests that monkeypatch
either the pipeline-level attribute or the underlying HTTP helper while also
deferring imports to avoid circular dependencies during runtime initialisation.</p>
<p>Args:
session: Requests session used to execute the outbound HTTP call.
method: HTTP verb such as <code class="docutils literal notranslate"><span class="pre">&quot;GET&quot;</span></code> or <code class="docutils literal notranslate"><span class="pre">&quot;HEAD&quot;</span></code>.
url: Fully qualified URL to fetch.
**kwargs: Additional keyword arguments forwarded to the HTTP helper.</p>
<p>Returns:
requests.Response: Response object produced by the proxied helper.</p>
<p>Raises:
requests.RequestException: Propagated from the underlying retry helper.</p>
</section>
<section id="callable-accepts-argument-func-name">
<h3><code class="docutils literal notranslate"><span class="pre">_callable_accepts_argument(func,</span> <span class="pre">name)</span></code><a class="headerlink" href="#callable-accepts-argument-func-name" title="Link to this heading"></a></h3>
<p>Return <code class="docutils literal notranslate"><span class="pre">True</span></code> when <code class="docutils literal notranslate"><span class="pre">func</span></code> accepts an argument named <code class="docutils literal notranslate"><span class="pre">name</span></code>.</p>
<p>Args:
func: Download function whose call signature should be inspected.
name: Argument name whose presence should be detected.</p>
<p>Returns:
bool: <code class="docutils literal notranslate"><span class="pre">True</span></code> when <code class="docutils literal notranslate"><span class="pre">func</span></code> accepts the argument or variable parameters.</p>
</section>
<section id="respect-rate-limit-self-resolver-name">
<h3><code class="docutils literal notranslate"><span class="pre">_respect_rate_limit(self,</span> <span class="pre">resolver_name)</span></code><a class="headerlink" href="#respect-rate-limit-self-resolver-name" title="Link to this heading"></a></h3>
<p>Sleep as required to respect per-resolver rate limiting policies.</p>
<p>The method performs an atomic read-modify-write on
:attr:<code class="docutils literal notranslate"><span class="pre">_last_invocation</span></code> guarded by :attr:<code class="docutils literal notranslate"><span class="pre">_lock</span></code> to ensure that
concurrent threads honour resolver spacing requirements.</p>
<p>Args:
resolver_name: Name of the resolver to rate limit.</p>
<p>Returns:
None</p>
</section>
<section id="respect-domain-limit-self-url">
<h3><code class="docutils literal notranslate"><span class="pre">_respect_domain_limit(self,</span> <span class="pre">url)</span></code><a class="headerlink" href="#respect-domain-limit-self-url" title="Link to this heading"></a></h3>
<p>Enforce per-domain throttling when configured.</p>
<p>Args:
url: Resolver URL whose host may be subject to throttling.</p>
<p>Returns:
None</p>
</section>
<section id="jitter-sleep-self">
<h3><code class="docutils literal notranslate"><span class="pre">_jitter_sleep(self)</span></code><a class="headerlink" href="#jitter-sleep-self" title="Link to this heading"></a></h3>
<p>Introduce a small delay to avoid stampeding downstream services.</p>
<p>Args:
self: Pipeline instance executing resolver scheduling logic.</p>
<p>Returns:
None</p>
</section>
<section id="should-attempt-head-check-self-resolver-name">
<h3><code class="docutils literal notranslate"><span class="pre">_should_attempt_head_check(self,</span> <span class="pre">resolver_name)</span></code><a class="headerlink" href="#should-attempt-head-check-self-resolver-name" title="Link to this heading"></a></h3>
<p>Return <code class="docutils literal notranslate"><span class="pre">True</span></code> when a resolver should perform a HEAD preflight request.</p>
<p>Args:
resolver_name: Name of the resolver under consideration.</p>
<p>Returns:
Boolean indicating whether the resolver should issue a HEAD request.</p>
</section>
<section id="head-precheck-url-self-session-url-timeout">
<h3><code class="docutils literal notranslate"><span class="pre">_head_precheck_url(self,</span> <span class="pre">session,</span> <span class="pre">url,</span> <span class="pre">timeout)</span></code><a class="headerlink" href="#head-precheck-url-self-session-url-timeout" title="Link to this heading"></a></h3>
<p>Issue a HEAD request to validate that <code class="docutils literal notranslate"><span class="pre">url</span></code> plausibly returns a PDF.</p>
<p>Args:
session: Requests session used for issuing the HEAD request.
url: Candidate URL whose response should be inspected.
timeout: Timeout budget for the preflight request.</p>
<p>Returns:
<code class="docutils literal notranslate"><span class="pre">True</span></code> when the response appears to represent a PDF download.</p>
</section>
<section id="run-self-session-artifact-context">
<h3><code class="docutils literal notranslate"><span class="pre">run(self,</span> <span class="pre">session,</span> <span class="pre">artifact,</span> <span class="pre">context)</span></code><a class="headerlink" href="#run-self-session-artifact-context" title="Link to this heading"></a></h3>
<p>Execute resolvers until a PDF is obtained or resolvers are exhausted.</p>
<p>Args:
session: Requests session used for resolver HTTP calls.
artifact: Work artifact describing the document to resolve.
context: Optional execution context containing flags such as <code class="docutils literal notranslate"><span class="pre">dry_run</span></code>.</p>
<p>Returns:
PipelineResult capturing resolver attempts and successful downloads.</p>
</section>
<section id="run-sequential-self-session-artifact-context-data-state">
<h3><code class="docutils literal notranslate"><span class="pre">_run_sequential(self,</span> <span class="pre">session,</span> <span class="pre">artifact,</span> <span class="pre">context_data,</span> <span class="pre">state)</span></code><a class="headerlink" href="#run-sequential-self-session-artifact-context-data-state" title="Link to this heading"></a></h3>
<p>Execute resolvers in order using the current thread.</p>
<p>Args:
session: Shared requests session for resolver HTTP calls.
artifact: Work artifact describing the document being processed.
context_data: Execution context dictionary.
state: Mutable run state tracking attempts and duplicates.</p>
<p>Returns:
PipelineResult summarising the sequential run outcome.</p>
</section>
<section id="run-concurrent-self-session-artifact-context-data-state">
<h3><code class="docutils literal notranslate"><span class="pre">_run_concurrent(self,</span> <span class="pre">session,</span> <span class="pre">artifact,</span> <span class="pre">context_data,</span> <span class="pre">state)</span></code><a class="headerlink" href="#run-concurrent-self-session-artifact-context-data-state" title="Link to this heading"></a></h3>
<p>Execute resolvers concurrently using a thread pool.</p>
<p>Args:
session: Shared requests session for resolver HTTP calls.
artifact: Work artifact describing the document being processed.
context_data: Execution context dictionary.
state: Mutable run state tracking attempts and duplicates.</p>
<p>Returns:
PipelineResult summarising the concurrent run outcome.</p>
</section>
<section id="prepare-resolver-self-resolver-name-order-index-artifact-state">
<h3><code class="docutils literal notranslate"><span class="pre">_prepare_resolver(self,</span> <span class="pre">resolver_name,</span> <span class="pre">order_index,</span> <span class="pre">artifact,</span> <span class="pre">state)</span></code><a class="headerlink" href="#prepare-resolver-self-resolver-name-order-index-artifact-state" title="Link to this heading"></a></h3>
<p>Return a prepared resolver or log skip events when unavailable.</p>
<p>Args:
resolver_name: Name of the resolver to prepare.
order_index: Execution order index for the resolver.
artifact: Work artifact being processed.
state: Mutable run state tracking skips and duplicates.</p>
<p>Returns:
Resolver instance when available and enabled, otherwise <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
</section>
<section id="collect-resolver-results-self-resolver-name-resolver-session-artifact">
<h3><code class="docutils literal notranslate"><span class="pre">_collect_resolver_results(self,</span> <span class="pre">resolver_name,</span> <span class="pre">resolver,</span> <span class="pre">session,</span> <span class="pre">artifact)</span></code><a class="headerlink" href="#collect-resolver-results-self-resolver-name-resolver-session-artifact" title="Link to this heading"></a></h3>
<p>Collect resolver results while applying rate limits and error handling.</p>
<p>Args:
resolver_name: Name of the resolver being executed (for logging and limits).
resolver: Resolver instance that will generate candidate URLs.
session: Requests session forwarded to the resolver.
artifact: Work artifact describing the current document.</p>
<p>Returns:
Tuple of resolver results and the resolver wall time (ms).</p>
</section>
<section id="process-result-self-session-artifact-resolver-name-order-index-result-context-data-state">
<h3><code class="docutils literal notranslate"><span class="pre">_process_result(self,</span> <span class="pre">session,</span> <span class="pre">artifact,</span> <span class="pre">resolver_name,</span> <span class="pre">order_index,</span> <span class="pre">result,</span> <span class="pre">context_data,</span> <span class="pre">state)</span></code><a class="headerlink" href="#process-result-self-session-artifact-resolver-name-order-index-result-context-data-state" title="Link to this heading"></a></h3>
<p>Process a single resolver result and return a terminal pipeline outcome.</p>
<p>Args:
session: Requests session used for follow-up download calls.
artifact: Work artifact describing the document being processed.
resolver_name: Name of the resolver that produced the result.
order_index: 1-based index of the resolver in the execution order.
result: Resolver result containing either a URL or event metadata.
context_data: Execution context dictionary.
state: Mutable run state tracking attempts and duplicates.
resolver_wall_time_ms: Wall-clock time spent in the resolver.</p>
<p>Returns:
PipelineResult when resolution succeeds, otherwise <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
</section>
<section id="submit-next-executor-start-index">
<h3><code class="docutils literal notranslate"><span class="pre">submit_next(executor,</span> <span class="pre">start_index)</span></code><a class="headerlink" href="#submit-next-executor-start-index" title="Link to this heading"></a></h3>
<p>Queue additional resolvers until reaching concurrency limits.</p>
<p>Args:
executor: Thread pool responsible for executing resolver calls.
start_index: Index in <code class="docutils literal notranslate"><span class="pre">resolver_order</span></code> where submission should resume.</p>
<p>Returns:
Updated index pointing to the next resolver candidate that has not been submitted.</p>
</section>
</section>
<section id="classes">
<h2>2. Classes<a class="headerlink" href="#classes" title="Link to this heading"></a></h2>
<section id="runstate">
<h3><code class="docutils literal notranslate"><span class="pre">_RunState</span></code><a class="headerlink" href="#runstate" title="Link to this heading"></a></h3>
<p>Mutable pipeline execution state shared across resolvers.</p>
<p>Args:
dry_run: Indicates whether downloads should be skipped.</p>
<p>Attributes:
dry_run: Indicates whether downloads should be skipped.
seen_urls: Set of URLs already attempted.
html_paths: Collected HTML fallback paths.
failed_urls: URLs that failed during resolution.
attempt_counter: Total number of resolver attempts performed.</p>
<p>Examples:</p>
<blockquote>
<div><blockquote>
<div><blockquote>
<div><p>state = _RunState(dry_run=True)
state.dry_run
True</p>
</div></blockquote>
</div></blockquote>
</div></blockquote>
</section>
<section id="resolverpipeline">
<h3><code class="docutils literal notranslate"><span class="pre">ResolverPipeline</span></code><a class="headerlink" href="#resolverpipeline" title="Link to this heading"></a></h3>
<p>Executes resolvers in priority order until a PDF download succeeds.</p>
<p>The pipeline is safe to reuse across worker threads when
:attr:<code class="docutils literal notranslate"><span class="pre">ResolverConfig.max_concurrent_resolvers</span></code> is greater than one. All
mutable shared state is protected by :class:<code class="docutils literal notranslate"><span class="pre">threading.Lock</span></code> instances and
only read concurrently without mutation. HTTP <code class="docutils literal notranslate"><span class="pre">requests.Session</span></code> objects
are treated as read-only; callers must avoid mutating shared sessions after
handing them to the pipeline.</p>
<p>Attributes:
config: Resolver configuration containing ordering and rate limits.
download_func: Callable responsible for downloading resolved URLs.
logger: Structured attempt logger capturing resolver telemetry.
metrics: Metrics collector tracking resolver performance.</p>
<p>Examples:</p>
<blockquote>
<div><blockquote>
<div><blockquote>
<div><p>pipeline = ResolverPipeline([], ResolverConfig(), lambda *args, **kwargs: None, None)  # doctest: +SKIP
isinstance(pipeline.metrics, ResolverMetrics)  # doctest: +SKIP
True</p>
</div></blockquote>
</div></blockquote>
</div></blockquote>
</section>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, DocsToKG Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>