

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Implementation Tasks &mdash; DocsToKG 1.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/custom.css" />


      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=8d563738"></script>
      <script src="../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
</head>

<body class="wy-body-for-nav">
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >



          <a href="../../../index.html" class="icon icon-home">
            DocsToKG
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../01-overview/index.html">1. Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../02-setup/index.html">1. Setup Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../03-architecture/index.html">1. Architecture Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../04-api/index.html">1. API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../05-development/index.html">1. Development Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../06-operations/index.html">1. Operations Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../07-reference/index.html">1. Technical Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">DocsToKG</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Implementation Tasks</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/openspec/changes/enhance-ontology-downloader-robustness/tasks.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">

  <section id="implementation-tasks">
<h1>Implementation Tasks<a class="headerlink" href="#implementation-tasks" title="Link to this heading"></a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading"></a></h2>
<p>This document provides detailed implementation tasks for enhancing the ontology downloader with explicit instructions for AI programming agents. Each task includes:</p>
<ul class="simple">
<li><p><strong>Objective</strong>: What needs to be accomplished</p></li>
<li><p><strong>Files to Modify</strong>: Specific file paths</p></li>
<li><p><strong>Implementation Details</strong>: Step-by-step instructions with code patterns</p></li>
<li><p><strong>Testing Requirements</strong>: Specific test scenarios to implement</p></li>
<li><p><strong>Acceptance Criteria</strong>: How to verify completion</p></li>
</ul>
</section>
<section id="foundation-code-cleanup-and-consolidation">
<h2>1. Foundation: Code Cleanup and Consolidation<a class="headerlink" href="#foundation-code-cleanup-and-consolidation" title="Link to this heading"></a></h2>
<section id="create-optional-dependency-module">
<h3>1.1 Create Optional Dependency Module<a class="headerlink" href="#create-optional-dependency-module" title="Link to this heading"></a></h3>
<section id="create-src-docstokg-ontologydownload-optdeps-py">
<h4>1.1.1 Create <code class="docutils literal notranslate"><span class="pre">src/DocsToKG/OntologyDownload/optdeps.py</span></code><a class="headerlink" href="#create-src-docstokg-ontologydownload-optdeps-py" title="Link to this heading"></a></h4>
<p><strong>Objective</strong>: Create centralized module for managing optional dependencies</p>
<p><strong>Implementation</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># File: src/DocsToKG/OntologyDownload/optdeps.py</span>
<span class="sd">&quot;&quot;&quot;Centralized optional dependency management with fallback stubs.&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">annotations</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="c1"># Module-level caches</span>
<span class="n">_pystow</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">_rdflib</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">_pronto</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">_owlready2</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
<p><strong>Acceptance Criteria</strong>:</p>
<ul class="simple">
<li><p>[x] File created at correct path</p></li>
<li><p>[x] Module imports without errors</p></li>
<li><p>[x] Empty module passes linting</p></li>
</ul>
</section>
<section id="implement-get-pystow-with-fallback-stub">
<h4>1.1.2 Implement <code class="docutils literal notranslate"><span class="pre">get_pystow()</span></code> with fallback stub<a class="headerlink" href="#implement-get-pystow-with-fallback-stub" title="Link to this heading"></a></h4>
<p><strong>Objective</strong>: Provide pystow or fallback implementation</p>
<p><strong>Implementation</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">_PystowFallback</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Minimal pystow replacement for when dependency is absent.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_root</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;PYSTOW_HOME&quot;</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()</span> <span class="o">/</span> <span class="s2">&quot;.data&quot;</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">join</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">segments</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Join path segments relative to fallback root.</span>

<span class="sd">        Args:</span>
<span class="sd">            *segments: Path components to append</span>

<span class="sd">        Returns:</span>
<span class="sd">            Path object under fallback directory</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_root</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="o">*</span><span class="n">segments</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">get_pystow</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get pystow module or fallback stub.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Real pystow module if installed, otherwise _PystowFallback instance</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; pystow = get_pystow()</span>
<span class="sd">        &gt;&gt;&gt; cache_dir = pystow.join(&quot;ontology-fetcher&quot;, &quot;cache&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">_pystow</span>
    <span class="k">if</span> <span class="n">_pystow</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span><span class="w"> </span><span class="nn">pystow</span>
            <span class="n">_pystow</span> <span class="o">=</span> <span class="n">pystow</span>
        <span class="k">except</span> <span class="ne">ModuleNotFoundError</span><span class="p">:</span>
            <span class="n">_pystow</span> <span class="o">=</span> <span class="n">_PystowFallback</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">_pystow</span>
</pre></div>
</div>
<p><strong>Testing Requirements</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># tests/ontology_download/test_optdeps.py</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_get_pystow_with_real_module</span><span class="p">(</span><span class="n">monkeypatch</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test get_pystow returns real module when installed.&quot;&quot;&quot;</span>
    <span class="c1"># Setup: ensure pystow is available</span>
    <span class="c1"># Test: call get_pystow()</span>
    <span class="c1"># Assert: returns actual pystow module with join method</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_get_pystow_fallback_when_missing</span><span class="p">(</span><span class="n">monkeypatch</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test get_pystow returns fallback when module missing.&quot;&quot;&quot;</span>
    <span class="c1"># Setup: monkeypatch import to raise ModuleNotFoundError</span>
    <span class="c1"># Test: call get_pystow()</span>
    <span class="c1"># Assert: returns _PystowFallback instance</span>
    <span class="c1"># Assert: fallback.join() returns Path object</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_pystow_fallback_respects_env_var</span><span class="p">(</span><span class="n">monkeypatch</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test fallback uses PYSTOW_HOME environment variable.&quot;&quot;&quot;</span>
    <span class="c1"># Setup: set PYSTOW_HOME=/custom/path</span>
    <span class="c1"># Test: create _PystowFallback(), call join(&quot;cache&quot;)</span>
    <span class="c1"># Assert: returns /custom/path/cache</span>
</pre></div>
</div>
<p><strong>Acceptance Criteria</strong>:</p>
<ul class="simple">
<li><p>[x] <code class="docutils literal notranslate"><span class="pre">get_pystow()</span></code> function implemented</p></li>
<li><p>[x] Fallback class provides <code class="docutils literal notranslate"><span class="pre">join()</span></code> method</p></li>
<li><p>[x] Caching works (same object returned on repeated calls)</p></li>
<li><p>[x] All tests pass</p></li>
</ul>
</section>
<section id="implement-get-rdflib-with-stub-graph-class">
<h4>1.1.3 Implement <code class="docutils literal notranslate"><span class="pre">get_rdflib()</span></code> with stub Graph class<a class="headerlink" href="#implement-get-rdflib-with-stub-graph-class" title="Link to this heading"></a></h4>
<p><strong>Objective</strong>: Provide rdflib or minimal stub for testing</p>
<p><strong>Implementation</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">_StubGraph</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Minimal Graph replacement for when rdflib is absent.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_source</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_triples</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">tuple</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">format</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Record source path for stub testing.</span>

<span class="sd">        Args:</span>
<span class="sd">            source: Path to RDF file</span>
<span class="sd">            format: RDF format (ignored in stub)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_source</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
        <span class="c1"># Stub: just record that parse was called</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return placeholder triple count.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="mi">1</span>  <span class="c1"># Stub always reports 1 triple</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">destination</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="nb">format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;turtle&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Write stub serialization.</span>

<span class="sd">        Args:</span>
<span class="sd">            destination: Output path or file object</span>
<span class="sd">            format: Serialization format</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dest_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">destination</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">destination</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">))</span> <span class="k">else</span> <span class="n">destination</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dest_path</span><span class="p">,</span> <span class="n">Path</span><span class="p">):</span>
            <span class="n">dest_path</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="n">dest_path</span><span class="o">.</span><span class="n">write_bytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_source</span><span class="o">.</span><span class="n">read_bytes</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dest_path</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="s2">&quot;# Stub TTL output</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">class</span><span class="w"> </span><span class="nc">_StubRDFLib</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Stub rdflib module.&quot;&quot;&quot;</span>
    <span class="n">Graph</span> <span class="o">=</span> <span class="n">_StubGraph</span>

<span class="k">def</span><span class="w"> </span><span class="nf">get_rdflib</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get rdflib module or stub.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Real rdflib if installed, otherwise _StubRDFLib</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; rdflib = get_rdflib()</span>
<span class="sd">        &gt;&gt;&gt; g = rdflib.Graph()</span>
<span class="sd">        &gt;&gt;&gt; g.parse(&quot;ontology.owl&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">_rdflib</span>
    <span class="k">if</span> <span class="n">_rdflib</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span><span class="w"> </span><span class="nn">rdflib</span>
            <span class="n">_rdflib</span> <span class="o">=</span> <span class="n">rdflib</span>
        <span class="k">except</span> <span class="ne">ModuleNotFoundError</span><span class="p">:</span>
            <span class="n">_rdflib</span> <span class="o">=</span> <span class="n">_StubRDFLib</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">_rdflib</span>
</pre></div>
</div>
<p><strong>Testing Requirements</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_get_rdflib_with_real_module</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test returns real rdflib when installed.&quot;&quot;&quot;</span>
    <span class="c1"># Test: import rdflib via get_rdflib()</span>
    <span class="c1"># Assert: has Graph class with parse, serialize methods</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_rdflib_stub_parse_records_source</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test stub records source path on parse.&quot;&quot;&quot;</span>
    <span class="c1"># Setup: create stub Graph</span>
    <span class="c1"># Test: call parse(&quot;test.owl&quot;)</span>
    <span class="c1"># Assert: _source attribute set to Path(&quot;test.owl&quot;)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_rdflib_stub_serialize_copies_source</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test stub serialize copies source to destination.&quot;&quot;&quot;</span>
    <span class="c1"># Setup: create temp source file, stub Graph, parse</span>
    <span class="c1"># Test: serialize to destination</span>
    <span class="c1"># Assert: destination exists with source content</span>
</pre></div>
</div>
<p><strong>Acceptance Criteria</strong>:</p>
<ul class="simple">
<li><p>[x] <code class="docutils literal notranslate"><span class="pre">get_rdflib()</span></code> function implemented</p></li>
<li><p>[x] Stub Graph has parse, serialize, <strong>len</strong> methods</p></li>
<li><p>[x] Stub behavior matches real rdflib interface for testing</p></li>
<li><p>[x] Tests pass</p></li>
</ul>
</section>
<section id="implement-get-pronto-with-stub-ontology-class">
<h4>1.1.4 Implement <code class="docutils literal notranslate"><span class="pre">get_pronto()</span></code> with stub Ontology class<a class="headerlink" href="#implement-get-pronto-with-stub-ontology-class" title="Link to this heading"></a></h4>
<p><strong>Objective</strong>: Provide pronto or stub for OBO parsing</p>
<p><strong>Implementation</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">_StubOntology</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Minimal Ontology stub for when pronto is absent.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handle</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize stub with ontology path.</span>

<span class="sd">        Args:</span>
<span class="sd">            handle: Path to ontology file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">terms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Yield placeholder terms.</span>

<span class="sd">        Yields:</span>
<span class="sd">            Placeholder term identifiers</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;TERM:0000001&quot;</span><span class="p">,</span> <span class="s2">&quot;TERM:0000002&quot;</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;obo&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Write minimal stub output.</span>

<span class="sd">        Args:</span>
<span class="sd">            file: Output file path</span>
<span class="sd">            format: Output format (obo, obojson)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">output_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="n">output_path</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="s2">&quot;obojson&quot;</span><span class="p">:</span>
            <span class="n">output_path</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="s1">&#39;{&quot;graphs&quot;: []}&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">output_path</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="s2">&quot;format-version: 1.2</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">class</span><span class="w"> </span><span class="nc">_StubPronto</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Stub pronto module.&quot;&quot;&quot;</span>
    <span class="n">Ontology</span> <span class="o">=</span> <span class="n">_StubOntology</span>

<span class="k">def</span><span class="w"> </span><span class="nf">get_pronto</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get pronto module or stub.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Real pronto if installed, otherwise _StubPronto</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">_pronto</span>
    <span class="k">if</span> <span class="n">_pronto</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span><span class="w"> </span><span class="nn">pronto</span>
            <span class="n">_pronto</span> <span class="o">=</span> <span class="n">pronto</span>
        <span class="k">except</span> <span class="ne">ModuleNotFoundError</span><span class="p">:</span>
            <span class="n">_pronto</span> <span class="o">=</span> <span class="n">_StubPronto</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">_pronto</span>
</pre></div>
</div>
<p><strong>Testing Requirements</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_pronto_stub_terms_returns_list</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test stub Ontology.terms() returns iterable.&quot;&quot;&quot;</span>
    <span class="c1"># Setup: create stub Ontology</span>
    <span class="c1"># Test: call terms()</span>
    <span class="c1"># Assert: returns non-empty iterable</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_pronto_stub_dump_creates_file</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test stub dump writes output file.&quot;&quot;&quot;</span>
    <span class="c1"># Setup: create stub Ontology, temp output dir</span>
    <span class="c1"># Test: call dump(path, format=&quot;obojson&quot;)</span>
    <span class="c1"># Assert: output file exists with JSON content</span>
</pre></div>
</div>
<p><strong>Acceptance Criteria</strong>:</p>
<ul class="simple">
<li><p>[x] <code class="docutils literal notranslate"><span class="pre">get_pronto()</span></code> function implemented</p></li>
<li><p>[x] Stub Ontology has terms(), dump() methods</p></li>
<li><p>[x] Tests pass</p></li>
</ul>
</section>
<section id="implement-get-owlready2-with-stub-wrapper">
<h4>1.1.5 Implement <code class="docutils literal notranslate"><span class="pre">get_owlready2()</span></code> with stub wrapper<a class="headerlink" href="#implement-get-owlready2-with-stub-wrapper" title="Link to this heading"></a></h4>
<p><strong>Objective</strong>: Provide owlready2 or stub for OWL reasoning</p>
<p><strong>Implementation</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">_StubLoadedOntology</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Stub for loaded ontology from owlready2.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">classes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return placeholder class list.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of placeholder class identifiers</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;Class1&quot;</span><span class="p">,</span> <span class="s2">&quot;Class2&quot;</span><span class="p">,</span> <span class="s2">&quot;Class3&quot;</span><span class="p">]</span>

<span class="k">class</span><span class="w"> </span><span class="nc">_StubOntologyWrapper</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Stub ontology wrapper.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iri</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize with IRI.</span>

<span class="sd">        Args:</span>
<span class="sd">            iri: Ontology IRI or file:// URI</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_iri</span> <span class="o">=</span> <span class="n">iri</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_StubLoadedOntology</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load ontology (stub returns placeholder).</span>

<span class="sd">        Returns:</span>
<span class="sd">            Stub loaded ontology</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_StubLoadedOntology</span><span class="p">()</span>

<span class="k">class</span><span class="w"> </span><span class="nc">_StubOwlready2</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Stub owlready2 module.&quot;&quot;&quot;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_ontology</span><span class="p">(</span><span class="n">iri</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_StubOntologyWrapper</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get ontology wrapper (stub).</span>

<span class="sd">        Args:</span>
<span class="sd">            iri: Ontology IRI</span>

<span class="sd">        Returns:</span>
<span class="sd">            Stub ontology wrapper</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_StubOntologyWrapper</span><span class="p">(</span><span class="n">iri</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">get_owlready2</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get owlready2 module or stub.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Real owlready2 if installed, otherwise _StubOwlready2</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">_owlready2</span>
    <span class="k">if</span> <span class="n">_owlready2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span><span class="w"> </span><span class="nn">owlready2</span>
            <span class="n">_owlready2</span> <span class="o">=</span> <span class="n">owlready2</span>
        <span class="k">except</span> <span class="ne">ModuleNotFoundError</span><span class="p">:</span>
            <span class="n">_owlready2</span> <span class="o">=</span> <span class="n">_StubOwlready2</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">_owlready2</span>
</pre></div>
</div>
<p><strong>Testing Requirements</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_owlready2_stub_get_ontology</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test stub get_ontology returns wrapper.&quot;&quot;&quot;</span>
    <span class="c1"># Setup: get stub owlready2</span>
    <span class="c1"># Test: call get_ontology(&quot;file:///path/to/ont.owl&quot;)</span>
    <span class="c1"># Assert: returns wrapper with load() method</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_owlready2_stub_load_returns_ontology</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test wrapper.load() returns ontology with classes.&quot;&quot;&quot;</span>
    <span class="c1"># Setup: create wrapper</span>
    <span class="c1"># Test: call load()</span>
    <span class="c1"># Assert: result has classes() method returning list</span>
</pre></div>
</div>
<p><strong>Acceptance Criteria</strong>:</p>
<ul class="simple">
<li><p>[x] <code class="docutils literal notranslate"><span class="pre">get_owlready2()</span></code> function implemented</p></li>
<li><p>[x] Stub provides get_ontology() → wrapper → load() → classes() chain</p></li>
<li><p>[x] Tests pass</p></li>
</ul>
</section>
<section id="add-comprehensive-docstrings-and-type-hints">
<h4>1.1.6 Add comprehensive docstrings and type hints<a class="headerlink" href="#add-comprehensive-docstrings-and-type-hints" title="Link to this heading"></a></h4>
<p><strong>Objective</strong>: Document all functions with Google-style docstrings</p>
<p><strong>Implementation</strong>:</p>
<ul class="simple">
<li><p>Add module-level docstring explaining purpose</p></li>
<li><p>Add docstrings to all functions with Args, Returns, Examples sections</p></li>
<li><p>Add type hints using <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">__future__</span> <span class="pre">import</span> <span class="pre">annotations</span></code></p></li>
<li><p>Add <code class="docutils literal notranslate"><span class="pre">__all__</span></code> export list</p></li>
</ul>
<p><strong>Example</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Centralized optional dependency management with fallback stubs.</span>

<span class="sd">This module provides getter functions for optional dependencies used by the</span>
<span class="sd">ontology downloader. When a dependency is not installed, lightweight stub</span>
<span class="sd">implementations are returned that provide minimal functionality for testing.</span>

<span class="sd">Examples:</span>
<span class="sd">    &gt;&gt;&gt; from DocsToKG.OntologyDownload.optdeps import get_pystow, get_rdflib</span>
<span class="sd">    &gt;&gt;&gt; pystow = get_pystow()</span>
<span class="sd">    &gt;&gt;&gt; cache_dir = pystow.join(&quot;ontology-fetcher&quot;, &quot;cache&quot;)</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;get_pystow&quot;</span><span class="p">,</span>
    <span class="s2">&quot;get_rdflib&quot;</span><span class="p">,</span>
    <span class="s2">&quot;get_pronto&quot;</span><span class="p">,</span>
    <span class="s2">&quot;get_owlready2&quot;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
<p><strong>Acceptance Criteria</strong>:</p>
<ul class="simple">
<li><p>[x] All functions have Google-style docstrings</p></li>
<li><p>[x] All functions have type hints</p></li>
<li><p>[x] Module docstring explains purpose</p></li>
<li><p>[x] <code class="docutils literal notranslate"><span class="pre">__all__</span></code> list defined</p></li>
</ul>
</section>
</section>
<section id="migrate-code-to-use-optdeps-module">
<h3>1.2 Migrate Code to Use optdeps Module<a class="headerlink" href="#migrate-code-to-use-optdeps-module" title="Link to this heading"></a></h3>
<section id="update-core-py-to-import-pystow-from-optdeps-get-pystow">
<h4>1.2.1 Update <code class="docutils literal notranslate"><span class="pre">core.py</span></code> to import pystow from <code class="docutils literal notranslate"><span class="pre">optdeps.get_pystow()</span></code><a class="headerlink" href="#update-core-py-to-import-pystow-from-optdeps-get-pystow" title="Link to this heading"></a></h4>
<p><strong>Objective</strong>: Replace local pystow stub with optdeps version</p>
<p><strong>Files to Modify</strong>: <code class="docutils literal notranslate"><span class="pre">src/DocsToKG/OntologyDownload/core.py</span></code></p>
<p><strong>Implementation Steps</strong>:</p>
<ol class="arabic simple">
<li><p>Remove lines 23-53 (local _PystowFallback class and try/except)</p></li>
<li><p>Add import at top: <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">.optdeps</span> <span class="pre">import</span> <span class="pre">get_pystow</span></code></p></li>
<li><p>Replace <code class="docutils literal notranslate"><span class="pre">pystow</span> <span class="pre">=</span> <span class="pre">_PystowFallback()</span></code> with <code class="docutils literal notranslate"><span class="pre">pystow</span> <span class="pre">=</span> <span class="pre">get_pystow()</span></code></p></li>
<li><p>Update all <code class="docutils literal notranslate"><span class="pre">pystow.join()</span></code> calls (should work unchanged)</p></li>
</ol>
<p><strong>Code Changes</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># OLD (lines 23-53):</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">pystow</span>
<span class="k">except</span> <span class="ne">ModuleNotFoundError</span><span class="p">:</span>
    <span class="k">class</span><span class="w"> </span><span class="nc">_PystowFallback</span><span class="p">:</span>
        <span class="c1"># ... implementation ...</span>
    <span class="n">pystow</span> <span class="o">=</span> <span class="n">_PystowFallback</span><span class="p">()</span>

<span class="c1"># NEW:</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.optdeps</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_pystow</span>
<span class="n">pystow</span> <span class="o">=</span> <span class="n">get_pystow</span><span class="p">()</span>
</pre></div>
</div>
<p><strong>Testing</strong>:</p>
<ul class="simple">
<li><p>Run existing tests for core.py</p></li>
<li><p>Verify DATA_ROOT, CACHE_DIR, etc. still work</p></li>
<li><p>Test with and without pystow installed</p></li>
</ul>
<p><strong>Acceptance Criteria</strong>:</p>
<ul class="simple">
<li><p>[x] Local stub removed</p></li>
<li><p>[x] optdeps import added</p></li>
<li><p>[x] All tests pass</p></li>
<li><p>[x] No functionality change</p></li>
</ul>
</section>
<section id="update-resolvers-py-to-import-pystow-from-optdeps-get-pystow">
<h4>1.2.2 Update <code class="docutils literal notranslate"><span class="pre">resolvers.py</span></code> to import pystow from <code class="docutils literal notranslate"><span class="pre">optdeps.get_pystow()</span></code><a class="headerlink" href="#update-resolvers-py-to-import-pystow-from-optdeps-get-pystow" title="Link to this heading"></a></h4>
<p><strong>Objective</strong>: Replace resolver pystow stub with optdeps</p>
<p><strong>Files to Modify</strong>: <code class="docutils literal notranslate"><span class="pre">src/DocsToKG/OntologyDownload/resolvers.py</span></code></p>
<p><strong>Implementation Steps</strong>:</p>
<ol class="arabic simple">
<li><p>Remove lines 23-53 (local _PystowFallback class)</p></li>
<li><p>Add import: <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">.optdeps</span> <span class="pre">import</span> <span class="pre">get_pystow</span></code></p></li>
<li><p>Replace <code class="docutils literal notranslate"><span class="pre">pystow</span> <span class="pre">=</span> <span class="pre">_PystowFallback()</span></code> with <code class="docutils literal notranslate"><span class="pre">pystow</span> <span class="pre">=</span> <span class="pre">get_pystow()</span></code></p></li>
</ol>
<p><strong>Acceptance Criteria</strong>:</p>
<ul class="simple">
<li><p>[x] Local stub removed</p></li>
<li><p>[x] optdeps import added</p></li>
<li><p>[x] Resolver tests pass</p></li>
</ul>
</section>
<section id="update-validators-py-to-import-rdflib-pronto-owlready2-from-optdeps">
<h4>1.2.3 Update <code class="docutils literal notranslate"><span class="pre">validators.py</span></code> to import rdflib, pronto, owlready2 from optdeps<a class="headerlink" href="#update-validators-py-to-import-rdflib-pronto-owlready2-from-optdeps" title="Link to this heading"></a></h4>
<p><strong>Objective</strong>: Replace all validator stubs with optdeps versions</p>
<p><strong>Files to Modify</strong>: <code class="docutils literal notranslate"><span class="pre">src/DocsToKG/OntologyDownload/validators.py</span></code></p>
<p><strong>Implementation Steps</strong>:</p>
<ol class="arabic">
<li><p>Remove lines 27-162 (all local stub classes)</p></li>
<li><p>Add imports at top:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">.optdeps</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_rdflib</span><span class="p">,</span> <span class="n">get_pronto</span><span class="p">,</span> <span class="n">get_owlready2</span>

<span class="n">rdflib</span> <span class="o">=</span> <span class="n">get_rdflib</span><span class="p">()</span>
<span class="n">pronto</span> <span class="o">=</span> <span class="n">get_pronto</span><span class="p">()</span>
<span class="n">owlready2</span> <span class="o">=</span> <span class="n">get_owlready2</span><span class="p">()</span>
</pre></div>
</div>
</li>
<li><p>All usage of rdflib, pronto, owlready2 should work unchanged</p></li>
</ol>
<p><strong>Acceptance Criteria</strong>:</p>
<ul class="simple">
<li><p>[x] All local stubs removed (135 lines deleted)</p></li>
<li><p>[x] optdeps imports added</p></li>
<li><p>[x] All validator tests pass</p></li>
</ul>
</section>
<section id="remove-all-local-stub-implementations">
<h4>1.2.4 Remove all local stub implementations<a class="headerlink" href="#remove-all-local-stub-implementations" title="Link to this heading"></a></h4>
<p><strong>Objective</strong>: Verify no duplicate stubs remain</p>
<p><strong>Implementation</strong>:</p>
<ul class="simple">
<li><p>Search for <code class="docutils literal notranslate"><span class="pre">class</span> <span class="pre">_Stub</span></code> in all files</p></li>
<li><p>Search for <code class="docutils literal notranslate"><span class="pre">class</span> <span class="pre">_Fallback</span></code> in all files</p></li>
<li><p>Ensure only optdeps.py contains stubs</p></li>
</ul>
<p><strong>Acceptance Criteria</strong>:</p>
<ul class="simple">
<li><p>[x] <code class="docutils literal notranslate"><span class="pre">grep</span> <span class="pre">-r</span> <span class="pre">&quot;class</span> <span class="pre">_Stub&quot;</span> <span class="pre">src/DocsToKG/OntologyDownload/</span></code> returns only optdeps.py</p></li>
<li><p>[x] No duplicate stub implementations exist</p></li>
</ul>
</section>
<section id="verify-tests-pass-with-centralized-stubs">
<h4>1.2.5 Verify tests pass with centralized stubs<a class="headerlink" href="#verify-tests-pass-with-centralized-stubs" title="Link to this heading"></a></h4>
<p><strong>Objective</strong>: Ensure migration didn’t break anything</p>
<p><strong>Implementation</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run full test suite for ontology download</span>
pytest<span class="w"> </span>tests/ontology_download/<span class="w"> </span>-v<span class="w"> </span>--tb<span class="o">=</span>short

<span class="c1"># Run with coverage</span>
pytest<span class="w"> </span>tests/ontology_download/<span class="w"> </span>--cov<span class="o">=</span>src/DocsToKG/OntologyDownload<span class="w"> </span>--cov-report<span class="o">=</span>term-missing

<span class="c1"># Test with pystow uninstalled</span>
pip<span class="w"> </span>uninstall<span class="w"> </span>-y<span class="w"> </span>pystow
pytest<span class="w"> </span>tests/ontology_download/test_core.py<span class="w"> </span>-v
pip<span class="w"> </span>install<span class="w"> </span>pystow
</pre></div>
</div>
<p><strong>Acceptance Criteria</strong>:</p>
<ul class="simple">
<li><p>[x] All tests pass with real dependencies</p></li>
<li><p>[x] All tests pass with stubs (dependencies uninstalled)</p></li>
<li><p>[x] No test breakage from migration</p></li>
</ul>
</section>
</section>
<section id="extract-cli-formatting-utilities">
<h3>1.3 Extract CLI Formatting Utilities<a class="headerlink" href="#extract-cli-formatting-utilities" title="Link to this heading"></a></h3>
<section id="create-src-docstokg-ontologydownload-cli-utils-py">
<h4>1.3.1 Create <code class="docutils literal notranslate"><span class="pre">src/DocsToKG/OntologyDownload/cli_utils.py</span></code><a class="headerlink" href="#create-src-docstokg-ontologydownload-cli-utils-py" title="Link to this heading"></a></h4>
<p><strong>Objective</strong>: Create module for reusable CLI formatting</p>
<p><strong>Implementation</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;CLI formatting utilities for ontology downloader.</span>

<span class="sd">Provides reusable formatting functions for tables, summaries, and structured</span>
<span class="sd">output across all CLI subcommands.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">annotations</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Sequence</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;format_table&quot;</span><span class="p">,</span>
    <span class="s2">&quot;format_validation_summary&quot;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
<p><strong>Acceptance Criteria</strong>:</p>
<ul class="simple">
<li><p>[x] File created</p></li>
<li><p>[x] Module imports successfully</p></li>
<li><p>[x] Has <code class="docutils literal notranslate"><span class="pre">__all__</span></code> export list</p></li>
</ul>
</section>
<section id="move-formatting-functions-from-cli-py-to-cli-utils-py">
<h4>1.3.2-1.3.4 Move formatting functions from cli.py to cli_utils.py<a class="headerlink" href="#move-formatting-functions-from-cli-py-to-cli-utils-py" title="Link to this heading"></a></h4>
<p><strong>Objective</strong>: Extract <code class="docutils literal notranslate"><span class="pre">_format_table</span></code>, <code class="docutils literal notranslate"><span class="pre">_format_row</span></code>, <code class="docutils literal notranslate"><span class="pre">_format_validation_summary</span></code></p>
<p><strong>Implementation</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># cli_utils.py</span>
<span class="k">def</span><span class="w"> </span><span class="nf">format_table</span><span class="p">(</span><span class="n">headers</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">rows</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Format data as ASCII table with headers.</span>

<span class="sd">    Args:</span>
<span class="sd">        headers: Column header strings</span>
<span class="sd">        rows: List of row data (each row is sequence of cell strings)</span>

<span class="sd">    Returns:</span>
<span class="sd">        Formatted table string with aligned columns and separator lines</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; print(format_table([&quot;Name&quot;, &quot;Status&quot;], [[&quot;hp&quot;, &quot;success&quot;], [&quot;efo&quot;, &quot;cached&quot;]]))</span>
<span class="sd">        Name | Status</span>
<span class="sd">        -----+--------</span>
<span class="sd">        hp   | success</span>
<span class="sd">        efo  | cached</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">widths</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">header</span><span class="p">)</span> <span class="k">for</span> <span class="n">header</span> <span class="ow">in</span> <span class="n">headers</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">cell</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
            <span class="n">widths</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">widths</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">cell</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">format_row</span><span class="p">(</span><span class="n">values</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot; | &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="n">widths</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">values</span><span class="p">))</span>

    <span class="n">separator</span> <span class="o">=</span> <span class="s2">&quot;-+-&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="n">width</span> <span class="k">for</span> <span class="n">width</span> <span class="ow">in</span> <span class="n">widths</span><span class="p">)</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">format_row</span><span class="p">(</span><span class="n">headers</span><span class="p">),</span> <span class="n">separator</span><span class="p">]</span>
    <span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">format_row</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">)</span>
    <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">format_validation_summary</span><span class="p">(</span><span class="n">results</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Format validation results as table.</span>

<span class="sd">    Args:</span>
<span class="sd">        results: Mapping of validator name to result dict with &#39;ok&#39; and &#39;details&#39;</span>

<span class="sd">    Returns:</span>
<span class="sd">        Formatted table showing validator, status, and details</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; results = {&quot;rdflib&quot;: {&quot;ok&quot;: True, &quot;details&quot;: {&quot;triples&quot;: 100}}}</span>
<span class="sd">        &gt;&gt;&gt; print(format_validation_summary(results))</span>
<span class="sd">        validator | status | details</span>
<span class="sd">        ----------+--------+--------------</span>
<span class="sd">        rdflib    | ok     | triples=100</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">payload</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;ok&quot;</span> <span class="k">if</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ok&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;error&quot;</span>
        <span class="n">details</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;details&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">details</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">if</span> <span class="s2">&quot;error&quot;</span> <span class="ow">in</span> <span class="n">details</span><span class="p">:</span>
                <span class="n">message</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">details</span><span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">details</span><span class="p">:</span>
                <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">details</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">name</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">message</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">format_table</span><span class="p">((</span><span class="s2">&quot;validator&quot;</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="s2">&quot;details&quot;</span><span class="p">),</span> <span class="n">rows</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Acceptance Criteria</strong>:</p>
<ul class="simple">
<li><p>[x] Functions moved from cli.py lines 143-170</p></li>
<li><p>[x] Functions renamed (remove <code class="docutils literal notranslate"><span class="pre">_</span></code> prefix, now public API)</p></li>
<li><p>[x] Docstrings added with examples</p></li>
<li><p>[x] Type hints added</p></li>
</ul>
</section>
<section id="update-cli-py-imports-to-use-cli-utils">
<h4>1.3.5 Update cli.py imports to use cli_utils<a class="headerlink" href="#update-cli-py-imports-to-use-cli-utils" title="Link to this heading"></a></h4>
<p><strong>Objective</strong>: Import and use new cli_utils functions</p>
<p><strong>Files to Modify</strong>: <code class="docutils literal notranslate"><span class="pre">src/DocsToKG/OntologyDownload/cli.py</span></code></p>
<p><strong>Implementation</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add to imports at top</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.cli_utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">format_table</span><span class="p">,</span> <span class="n">format_validation_summary</span>

<span class="c1"># Replace usage:</span>
<span class="c1"># OLD: table = _format_table(...)</span>
<span class="c1"># NEW: table = format_table(...)</span>

<span class="c1"># OLD: print(_format_validation_summary(summary))</span>
<span class="c1"># NEW: print(format_validation_summary(summary))</span>
</pre></div>
</div>
<p><strong>Specific Changes</strong>:</p>
<ul class="simple">
<li><p>Line 313: Change <code class="docutils literal notranslate"><span class="pre">_format_table</span></code> to <code class="docutils literal notranslate"><span class="pre">format_table</span></code></p></li>
<li><p>Line 346: Change <code class="docutils literal notranslate"><span class="pre">_format_validation_summary</span></code> to <code class="docutils literal notranslate"><span class="pre">format_validation_summary</span></code></p></li>
<li><p>Remove lines 143-170 (old function definitions)</p></li>
</ul>
<p><strong>Acceptance Criteria</strong>:</p>
<ul class="simple">
<li><p>[x] cli.py imports from cli_utils</p></li>
<li><p>[x] All calls updated to new names</p></li>
<li><p>[x] Old function definitions removed</p></li>
<li><p>[x] CLI tests pass</p></li>
</ul>
</section>
<section id="add-unit-tests-for-cli-utils-formatting-functions">
<h4>1.3.6 Add unit tests for cli_utils formatting functions<a class="headerlink" href="#add-unit-tests-for-cli-utils-formatting-functions" title="Link to this heading"></a></h4>
<p><strong>Objective</strong>: Test formatting functions in isolation</p>
<p><strong>Files to Create</strong>: <code class="docutils literal notranslate"><span class="pre">tests/ontology_download/test_cli_utils.py</span></code></p>
<p><strong>Implementation</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Tests for CLI formatting utilities.&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">DocsToKG.OntologyDownload.cli_utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">format_table</span><span class="p">,</span> <span class="n">format_validation_summary</span>


<span class="k">def</span><span class="w"> </span><span class="nf">test_format_table_basic</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test basic table formatting with headers and rows.&quot;&quot;&quot;</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ID&quot;</span><span class="p">,</span> <span class="s2">&quot;Status&quot;</span><span class="p">]</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="p">[[</span><span class="s2">&quot;hp&quot;</span><span class="p">,</span> <span class="s2">&quot;success&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;efo&quot;</span><span class="p">,</span> <span class="s2">&quot;cached&quot;</span><span class="p">]]</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">format_table</span><span class="p">(</span><span class="n">headers</span><span class="p">,</span> <span class="n">rows</span><span class="p">)</span>

    <span class="k">assert</span> <span class="s2">&quot;ID&quot;</span> <span class="ow">in</span> <span class="n">result</span>
    <span class="k">assert</span> <span class="s2">&quot;Status&quot;</span> <span class="ow">in</span> <span class="n">result</span>
    <span class="k">assert</span> <span class="s2">&quot;hp&quot;</span> <span class="ow">in</span> <span class="n">result</span>
    <span class="k">assert</span> <span class="s2">&quot;success&quot;</span> <span class="ow">in</span> <span class="n">result</span>
    <span class="k">assert</span> <span class="s2">&quot;|&quot;</span> <span class="ow">in</span> <span class="n">result</span>  <span class="c1"># column separator</span>
    <span class="k">assert</span> <span class="s2">&quot;-&quot;</span> <span class="ow">in</span> <span class="n">result</span>  <span class="c1"># header separator</span>


<span class="k">def</span><span class="w"> </span><span class="nf">test_format_table_column_alignment</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test columns are aligned by widest cell.&quot;&quot;&quot;</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Short&quot;</span><span class="p">,</span> <span class="s2">&quot;Longer Header&quot;</span><span class="p">]</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="p">[[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;xyz&quot;</span><span class="p">,</span> <span class="s2">&quot;abcdefgh&quot;</span><span class="p">]]</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">format_table</span><span class="p">(</span><span class="n">headers</span><span class="p">,</span> <span class="n">rows</span><span class="p">)</span>

    <span class="n">lines</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># All lines should have same width (within reason for separators)</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">4</span>  <span class="c1"># header + separator + 2 rows</span>
    <span class="c1"># Check alignment (headers/rows should align)</span>
    <span class="k">assert</span> <span class="s2">&quot;Short&quot;</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">assert</span> <span class="s2">&quot;xyz&quot;</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>


<span class="k">def</span><span class="w"> </span><span class="nf">test_format_table_empty_rows</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test table with headers but no data rows.&quot;&quot;&quot;</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Name&quot;</span><span class="p">,</span> <span class="s2">&quot;Value&quot;</span><span class="p">]</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">format_table</span><span class="p">(</span><span class="n">headers</span><span class="p">,</span> <span class="n">rows</span><span class="p">)</span>

    <span class="k">assert</span> <span class="s2">&quot;Name&quot;</span> <span class="ow">in</span> <span class="n">result</span>
    <span class="k">assert</span> <span class="s2">&quot;Value&quot;</span> <span class="ow">in</span> <span class="n">result</span>
    <span class="c1"># Should still show headers and separator</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>  <span class="c1"># header + separator only</span>


<span class="k">def</span><span class="w"> </span><span class="nf">test_format_validation_summary_success</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test validation summary with successful validator.&quot;&quot;&quot;</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;rdflib&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;ok&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;details&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;triples&quot;</span><span class="p">:</span> <span class="mi">1234</span><span class="p">,</span> <span class="s2">&quot;elapsed&quot;</span><span class="p">:</span> <span class="mf">2.5</span><span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">format_validation_summary</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>

    <span class="k">assert</span> <span class="s2">&quot;rdflib&quot;</span> <span class="ow">in</span> <span class="n">result</span>
    <span class="k">assert</span> <span class="s2">&quot;ok&quot;</span> <span class="ow">in</span> <span class="n">result</span>
    <span class="k">assert</span> <span class="s2">&quot;triples=1234&quot;</span> <span class="ow">in</span> <span class="n">result</span>


<span class="k">def</span><span class="w"> </span><span class="nf">test_format_validation_summary_error</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test validation summary with failed validator.&quot;&quot;&quot;</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;pronto&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;ok&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;details&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;timeout after 60s&quot;</span><span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">format_validation_summary</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>

    <span class="k">assert</span> <span class="s2">&quot;pronto&quot;</span> <span class="ow">in</span> <span class="n">result</span>
    <span class="k">assert</span> <span class="s2">&quot;error&quot;</span> <span class="ow">in</span> <span class="n">result</span>
    <span class="k">assert</span> <span class="s2">&quot;timeout&quot;</span> <span class="ow">in</span> <span class="n">result</span>


<span class="k">def</span><span class="w"> </span><span class="nf">test_format_validation_summary_multiple</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test summary with multiple validators.&quot;&quot;&quot;</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;rdflib&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;ok&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;details&quot;</span><span class="p">:</span> <span class="p">{}},</span>
        <span class="s2">&quot;pronto&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;ok&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;details&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;parse error&quot;</span><span class="p">}},</span>
        <span class="s2">&quot;owlready2&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;ok&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;details&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;entities&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">}}</span>
    <span class="p">}</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">format_validation_summary</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>

    <span class="k">assert</span> <span class="s2">&quot;rdflib&quot;</span> <span class="ow">in</span> <span class="n">result</span>
    <span class="k">assert</span> <span class="s2">&quot;pronto&quot;</span> <span class="ow">in</span> <span class="n">result</span>
    <span class="k">assert</span> <span class="s2">&quot;owlready2&quot;</span> <span class="ow">in</span> <span class="n">result</span>
    <span class="c1"># Should have 3 data rows + header + separator</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span>
</pre></div>
</div>
<p><strong>Acceptance Criteria</strong>:</p>
<ul class="simple">
<li><p>[x] Test file created with 6+ test cases</p></li>
<li><p>[x] Tests cover basic formatting, alignment, empty cases, errors</p></li>
<li><p>[x] All tests pass</p></li>
<li><p>[x] Coverage &gt;95% for cli_utils.py</p></li>
</ul>
</section>
</section>
<section id="migrate-configuration-to-pydantic-v2">
<h3>1.4 Migrate Configuration to Pydantic v2<a class="headerlink" href="#migrate-configuration-to-pydantic-v2" title="Link to this heading"></a></h3>
<section id="add-pydantic-2-0-0-to-requirements-txt">
<h4>1.4.1 Add pydantic&gt;=2.0.0 to requirements.txt<a class="headerlink" href="#add-pydantic-2-0-0-to-requirements-txt" title="Link to this heading"></a></h4>
<p><strong>Objective</strong>: Add Pydantic v2 as required dependency</p>
<p><strong>Files to Modify</strong>: <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> (or <code class="docutils literal notranslate"><span class="pre">requirements.in</span></code> if using pip-compile)</p>
<p><strong>Implementation</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add to requirements</span>
<span class="n">pydantic</span><span class="o">&gt;=</span><span class="mf">2.0.0</span><span class="p">,</span><span class="o">&lt;</span><span class="mf">3.0.0</span>
</pre></div>
</div>
<p><strong>Testing</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>requirements.txt
python<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;import pydantic; print(pydantic.__version__)&quot;</span>
<span class="c1"># Should print 2.x.x</span>
</pre></div>
</div>
<p><strong>Acceptance Criteria</strong>:</p>
<ul class="simple">
<li><p>[x] Pydantic 2.x added to requirements</p></li>
<li><p>[x] Installs successfully</p></li>
<li><p>[x] Version constraint prevents Pydantic 1.x</p></li>
</ul>
</section>
<section id="convert-loggingconfiguration-dataclass-to-pydantic-basemodel">
<h4>1.4.2 Convert <code class="docutils literal notranslate"><span class="pre">LoggingConfiguration</span></code> dataclass to Pydantic <code class="docutils literal notranslate"><span class="pre">BaseModel</span></code><a class="headerlink" href="#convert-loggingconfiguration-dataclass-to-pydantic-basemodel" title="Link to this heading"></a></h4>
<p><strong>Objective</strong>: Replace dataclass with Pydantic model</p>
<p><strong>Files to Modify</strong>: <code class="docutils literal notranslate"><span class="pre">src/DocsToKG/OntologyDownload/config.py</span></code></p>
<p><strong>Implementation</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add imports at top</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">Field</span><span class="p">,</span> <span class="n">field_validator</span>

<span class="c1"># Replace dataclass (lines 183-200)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">LoggingConfiguration</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Structured logging options for ontology download operations.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        level: Logging level name (DEBUG, INFO, WARNING, ERROR)</span>
<span class="sd">        max_log_size_mb: Maximum individual log file size before rotation</span>
<span class="sd">        retention_days: Number of days to keep logs prior to deletion</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">level</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;INFO&quot;</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Logging level (DEBUG, INFO, WARNING, ERROR)&quot;</span>
    <span class="p">)</span>
    <span class="n">max_log_size_mb</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
        <span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Maximum log file size in MB before rotation&quot;</span>
    <span class="p">)</span>
    <span class="n">retention_days</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
        <span class="n">ge</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Number of days to retain logs&quot;</span>
    <span class="p">)</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s1">&#39;level&#39;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_level</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate logging level is recognized.&quot;&quot;&quot;</span>
        <span class="n">valid_levels</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">,</span> <span class="s2">&quot;INFO&quot;</span><span class="p">,</span> <span class="s2">&quot;WARNING&quot;</span><span class="p">,</span> <span class="s2">&quot;ERROR&quot;</span><span class="p">}</span>
        <span class="n">upper</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">upper</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_levels</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;level must be one of </span><span class="si">{</span><span class="n">valid_levels</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">upper</span>

    <span class="n">model_config</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;frozen&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>  <span class="c1"># Allow mutation for env var overrides</span>
        <span class="s2">&quot;validate_assignment&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">}</span>
</pre></div>
</div>
<p><strong>Testing Requirements</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># tests/ontology_download/test_config.py</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test_logging_config_defaults</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test LoggingConfiguration uses correct defaults.&quot;&quot;&quot;</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">LoggingConfiguration</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">config</span><span class="o">.</span><span class="n">level</span> <span class="o">==</span> <span class="s2">&quot;INFO&quot;</span>
    <span class="k">assert</span> <span class="n">config</span><span class="o">.</span><span class="n">max_log_size_mb</span> <span class="o">==</span> <span class="mi">100</span>
    <span class="k">assert</span> <span class="n">config</span><span class="o">.</span><span class="n">retention_days</span> <span class="o">==</span> <span class="mi">30</span>


<span class="k">def</span><span class="w"> </span><span class="nf">test_logging_config_validates_level</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test invalid logging level raises ValidationError.&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">)</span> <span class="k">as</span> <span class="n">exc_info</span><span class="p">:</span>
        <span class="n">LoggingConfiguration</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s2">&quot;INVALID&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="s2">&quot;level must be one of&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc_info</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">test_logging_config_case_insensitive_level</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test logging level accepts lowercase and normalizes.&quot;&quot;&quot;</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">LoggingConfiguration</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s2">&quot;debug&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">config</span><span class="o">.</span><span class="n">level</span> <span class="o">==</span> <span class="s2">&quot;DEBUG&quot;</span>


<span class="k">def</span><span class="w"> </span><span class="nf">test_logging_config_validates_positive_values</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test max_log_size_mb must be positive.&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">):</span>
        <span class="n">LoggingConfiguration</span><span class="p">(</span><span class="n">max_log_size_mb</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">):</span>
        <span class="n">LoggingConfiguration</span><span class="p">(</span><span class="n">max_log_size_mb</span><span class="o">=-</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Acceptance Criteria</strong>:</p>
<ul class="simple">
<li><p>[x] Dataclass decorator removed</p></li>
<li><p>[x] Inherits from BaseModel</p></li>
<li><p>[x] Field() definitions with constraints</p></li>
<li><p>[x] field_validator for level</p></li>
<li><p>[x] Tests updated and passing</p></li>
</ul>
</section>
<section id="convert-validationconfig-dataclass-to-pydantic-basemodel">
<h4>1.4.3 Convert <code class="docutils literal notranslate"><span class="pre">ValidationConfig</span></code> dataclass to Pydantic <code class="docutils literal notranslate"><span class="pre">BaseModel</span></code><a class="headerlink" href="#convert-validationconfig-dataclass-to-pydantic-basemodel" title="Link to this heading"></a></h4>
<p><strong>Objective</strong>: Replace ValidationConfig dataclass</p>
<p><strong>Implementation</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">ValidationConfig</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validation limits governing parser execution.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        parser_timeout_sec: Maximum runtime per validator</span>
<span class="sd">        max_memory_mb: Memory ceiling for validation processes</span>
<span class="sd">        skip_reasoning_if_size_mb: Threshold to disable reasoning</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">parser_timeout_sec</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>
        <span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">le</span><span class="o">=</span><span class="mi">3600</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Parser timeout in seconds (max 1 hour)&quot;</span>
    <span class="p">)</span>
    <span class="n">max_memory_mb</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="mi">2048</span><span class="p">,</span>
        <span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Maximum memory in MB for validators&quot;</span>
    <span class="p">)</span>
    <span class="n">skip_reasoning_if_size_mb</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
        <span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;File size threshold to skip reasoning&quot;</span>
    <span class="p">)</span>

    <span class="n">model_config</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;frozen&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s2">&quot;validate_assignment&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">}</span>
</pre></div>
</div>
<p><strong>Testing Requirements</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_validation_config_timeout_bounds</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test parser_timeout_sec has reasonable bounds.&quot;&quot;&quot;</span>
    <span class="c1"># Should reject 0 or negative</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">):</span>
        <span class="n">ValidationConfig</span><span class="p">(</span><span class="n">parser_timeout_sec</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Should reject &gt; 1 hour</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">):</span>
        <span class="n">ValidationConfig</span><span class="p">(</span><span class="n">parser_timeout_sec</span><span class="o">=</span><span class="mi">4000</span><span class="p">)</span>

    <span class="c1"># Should accept reasonable values</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">ValidationConfig</span><span class="p">(</span><span class="n">parser_timeout_sec</span><span class="o">=</span><span class="mi">120</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">config</span><span class="o">.</span><span class="n">parser_timeout_sec</span> <span class="o">==</span> <span class="mi">120</span>
</pre></div>
</div>
<p><strong>Acceptance Criteria</strong>:</p>
<ul class="simple">
<li><p>[x] Converted to BaseModel</p></li>
<li><p>[x] Constraints on timeout (1 second to 1 hour)</p></li>
<li><p>[x] Tests updated</p></li>
</ul>
</section>
<section id="convert-downloadconfiguration-dataclass-to-pydantic-basemodel">
<h4>1.4.4 Convert <code class="docutils literal notranslate"><span class="pre">DownloadConfiguration</span></code> dataclass to Pydantic <code class="docutils literal notranslate"><span class="pre">BaseModel</span></code><a class="headerlink" href="#convert-downloadconfiguration-dataclass-to-pydantic-basemodel" title="Link to this heading"></a></h4>
<p><strong>Objective</strong>: Replace DownloadConfiguration with more validation</p>
<p><strong>Implementation</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">DownloadConfiguration</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;HTTP download and retry settings.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        max_retries: Number of retries for transient failures</span>
<span class="sd">        timeout_sec: Timeout for connection and read</span>
<span class="sd">        download_timeout_sec: Upper bound for whole file download</span>
<span class="sd">        backoff_factor: Backoff multiplier between retries</span>
<span class="sd">        per_host_rate_limit: Token bucket rate limit definition</span>
<span class="sd">        max_download_size_gb: Maximum allowed archive size</span>
<span class="sd">        concurrent_downloads: Maximum concurrent workers</span>
<span class="sd">        validate_media_type: Enable HEAD request media type validation</span>
<span class="sd">        rate_limits: Per-service rate limit overrides</span>
<span class="sd">        allowed_hosts: Optional host allowlist for URL validation</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">max_retries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">le</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">timeout_sec</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">le</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
    <span class="n">download_timeout_sec</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">le</span><span class="o">=</span><span class="mi">3600</span><span class="p">)</span>
    <span class="n">backoff_factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">le</span><span class="o">=</span><span class="mf">10.0</span><span class="p">)</span>
    <span class="n">per_host_rate_limit</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;4/second&quot;</span><span class="p">,</span>
        <span class="n">pattern</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;^\d+(\.\d+)?/(second|sec|s|minute|min|m|hour|h)$&quot;</span>
    <span class="p">)</span>
    <span class="n">max_download_size_gb</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">le</span><span class="o">=</span><span class="mf">100.0</span><span class="p">)</span>
    <span class="n">concurrent_downloads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">le</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">validate_media_type</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">rate_limits</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="n">allowed_hosts</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s1">&#39;rate_limits&#39;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_rate_limits</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate all rate limit values have correct format.&quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^\d+(\.\d+)?/(second|sec|s|minute|min|m|hour|h)$&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">service</span><span class="p">,</span> <span class="n">limit</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">limit</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Invalid rate limit &#39;</span><span class="si">{</span><span class="n">limit</span><span class="si">}</span><span class="s2">&#39; for service &#39;</span><span class="si">{</span><span class="n">service</span><span class="si">}</span><span class="s2">&#39;. &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;Expected format: &lt;number&gt;/&lt;unit&gt; (e.g., &#39;5/second&#39;, &#39;60/min&#39;)&quot;</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="n">v</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">rate_limit_per_second</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert per_host_rate_limit to requests per second.&quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^([\d.]+)/(second|sec|s|minute|min|m|hour|h)$&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">per_host_rate_limit</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid rate limit format: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">per_host_rate_limit</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">unit</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">unit</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;second&quot;</span><span class="p">,</span> <span class="s2">&quot;sec&quot;</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="k">elif</span> <span class="n">unit</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;minute&quot;</span><span class="p">,</span> <span class="s2">&quot;min&quot;</span><span class="p">,</span> <span class="s2">&quot;m&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">value</span> <span class="o">/</span> <span class="mf">60.0</span>
        <span class="k">elif</span> <span class="n">unit</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;hour&quot;</span><span class="p">,</span> <span class="s2">&quot;h&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">value</span> <span class="o">/</span> <span class="mf">3600.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown rate limit unit: </span><span class="si">{</span><span class="n">unit</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">parse_service_rate_limit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">service</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse rate limit for specific service to requests per second.</span>

<span class="sd">        Args:</span>
<span class="sd">            service: Service identifier (e.g., &quot;obo&quot;, &quot;ols&quot;, &quot;bioportal&quot;)</span>

<span class="sd">        Returns:</span>
<span class="sd">            Requests per second for service, or None if not configured</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">limit_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rate_limits</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">service</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">limit_str</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^([\d.]+)/(second|sec|s|minute|min|m|hour|h)$&quot;</span><span class="p">,</span> <span class="n">limit_str</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">unit</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">unit</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;second&quot;</span><span class="p">,</span> <span class="s2">&quot;sec&quot;</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="k">elif</span> <span class="n">unit</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;minute&quot;</span><span class="p">,</span> <span class="s2">&quot;min&quot;</span><span class="p">,</span> <span class="s2">&quot;m&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">value</span> <span class="o">/</span> <span class="mf">60.0</span>
        <span class="k">elif</span> <span class="n">unit</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;hour&quot;</span><span class="p">,</span> <span class="s2">&quot;h&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">value</span> <span class="o">/</span> <span class="mf">3600.0</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">model_config</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;frozen&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s2">&quot;validate_assignment&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">}</span>
</pre></div>
</div>
<p><strong>Testing Requirements</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_download_config_rate_limit_formats</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test various rate limit format permutations.&quot;&quot;&quot;</span>
    <span class="c1"># Test per-second</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">DownloadConfiguration</span><span class="p">(</span><span class="n">per_host_rate_limit</span><span class="o">=</span><span class="s2">&quot;5/second&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">config</span><span class="o">.</span><span class="n">rate_limit_per_second</span><span class="p">()</span> <span class="o">==</span> <span class="mf">5.0</span>

    <span class="n">config</span> <span class="o">=</span> <span class="n">DownloadConfiguration</span><span class="p">(</span><span class="n">per_host_rate_limit</span><span class="o">=</span><span class="s2">&quot;5/s&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">config</span><span class="o">.</span><span class="n">rate_limit_per_second</span><span class="p">()</span> <span class="o">==</span> <span class="mf">5.0</span>

    <span class="c1"># Test per-minute</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">DownloadConfiguration</span><span class="p">(</span><span class="n">per_host_rate_limit</span><span class="o">=</span><span class="s2">&quot;60/minute&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">config</span><span class="o">.</span><span class="n">rate_limit_per_second</span><span class="p">()</span> <span class="o">==</span> <span class="mf">1.0</span>

    <span class="n">config</span> <span class="o">=</span> <span class="n">DownloadConfiguration</span><span class="p">(</span><span class="n">per_host_rate_limit</span><span class="o">=</span><span class="s2">&quot;30/min&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">config</span><span class="o">.</span><span class="n">rate_limit_per_second</span><span class="p">()</span> <span class="o">==</span> <span class="mf">0.5</span>

    <span class="c1"># Test per-hour</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">DownloadConfiguration</span><span class="p">(</span><span class="n">per_host_rate_limit</span><span class="o">=</span><span class="s2">&quot;3600/hour&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">config</span><span class="o">.</span><span class="n">rate_limit_per_second</span><span class="p">()</span> <span class="o">==</span> <span class="mf">1.0</span>

    <span class="n">config</span> <span class="o">=</span> <span class="n">DownloadConfiguration</span><span class="p">(</span><span class="n">per_host_rate_limit</span><span class="o">=</span><span class="s2">&quot;1800/h&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">config</span><span class="o">.</span><span class="n">rate_limit_per_second</span><span class="p">()</span> <span class="o">==</span> <span class="mf">0.5</span>

    <span class="c1"># Test decimal values</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">DownloadConfiguration</span><span class="p">(</span><span class="n">per_host_rate_limit</span><span class="o">=</span><span class="s2">&quot;0.5/second&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">config</span><span class="o">.</span><span class="n">rate_limit_per_second</span><span class="p">()</span> <span class="o">==</span> <span class="mf">0.5</span>


<span class="k">def</span><span class="w"> </span><span class="nf">test_download_config_service_rate_limits</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test per-service rate limit configuration.&quot;&quot;&quot;</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">DownloadConfiguration</span><span class="p">(</span>
        <span class="n">rate_limits</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;obo&quot;</span><span class="p">:</span> <span class="s2">&quot;2/second&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ols&quot;</span><span class="p">:</span> <span class="s2">&quot;5/minute&quot;</span><span class="p">,</span>
            <span class="s2">&quot;bioportal&quot;</span><span class="p">:</span> <span class="s2">&quot;100/hour&quot;</span>
        <span class="p">}</span>
    <span class="p">)</span>

    <span class="k">assert</span> <span class="n">config</span><span class="o">.</span><span class="n">parse_service_rate_limit</span><span class="p">(</span><span class="s2">&quot;obo&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mf">2.0</span>
    <span class="k">assert</span> <span class="n">config</span><span class="o">.</span><span class="n">parse_service_rate_limit</span><span class="p">(</span><span class="s2">&quot;ols&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">pytest</span><span class="o">.</span><span class="n">approx</span><span class="p">(</span><span class="mf">5.0</span><span class="o">/</span><span class="mf">60.0</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">config</span><span class="o">.</span><span class="n">parse_service_rate_limit</span><span class="p">(</span><span class="s2">&quot;bioportal&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">pytest</span><span class="o">.</span><span class="n">approx</span><span class="p">(</span><span class="mf">100.0</span><span class="o">/</span><span class="mf">3600.0</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">config</span><span class="o">.</span><span class="n">parse_service_rate_limit</span><span class="p">(</span><span class="s2">&quot;unknown&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span>


<span class="k">def</span><span class="w"> </span><span class="nf">test_download_config_invalid_rate_limit</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test invalid rate limit format raises ValidationError.&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">)</span> <span class="k">as</span> <span class="n">exc_info</span><span class="p">:</span>
        <span class="n">DownloadConfiguration</span><span class="p">(</span><span class="n">per_host_rate_limit</span><span class="o">=</span><span class="s2">&quot;invalid&quot;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="s2">&quot;pattern&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc_info</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>


<span class="k">def</span><span class="w"> </span><span class="nf">test_download_config_allowed_hosts</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test allowed_hosts configuration.&quot;&quot;&quot;</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">DownloadConfiguration</span><span class="p">(</span>
        <span class="n">allowed_hosts</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;example.org&quot;</span><span class="p">,</span> <span class="s2">&quot;purl.obolibrary.org&quot;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="k">assert</span> <span class="s2">&quot;example.org&quot;</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">allowed_hosts</span>
    <span class="k">assert</span> <span class="s2">&quot;purl.obolibrary.org&quot;</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">allowed_hosts</span>
</pre></div>
</div>
<p><strong>Acceptance Criteria</strong>:</p>
<ul class="simple">
<li><p>[x] Converted to BaseModel</p></li>
<li><p>[x] New fields: validate_media_type, rate_limits, allowed_hosts</p></li>
<li><p>[x] rate_limit_per_second() method works</p></li>
<li><p>[x] parse_service_rate_limit() method added</p></li>
<li><p>[x] All tests pass</p></li>
</ul>
</section>
<section id="convert-defaultsconfig-and-resolvedconfig-to-pydantic">
<h4>1.4.5-1.4.6 Convert <code class="docutils literal notranslate"><span class="pre">DefaultsConfig</span></code> and <code class="docutils literal notranslate"><span class="pre">ResolvedConfig</span></code> to Pydantic<a class="headerlink" href="#convert-defaultsconfig-and-resolvedconfig-to-pydantic" title="Link to this heading"></a></h4>
<p><strong>Objective</strong>: Complete Pydantic migration for all config classes</p>
<p><strong>Implementation</strong> for DefaultsConfig:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">DefaultsConfig</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Collection of default settings for ontology fetch specifications.&quot;&quot;&quot;</span>

    <span class="n">accept_licenses</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;CC-BY-4.0&quot;</span><span class="p">,</span> <span class="s2">&quot;CC0-1.0&quot;</span><span class="p">,</span> <span class="s2">&quot;OGL-UK-3.0&quot;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">normalize_to</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;ttl&quot;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">prefer_source</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;obo&quot;</span><span class="p">,</span> <span class="s2">&quot;ols&quot;</span><span class="p">,</span> <span class="s2">&quot;bioportal&quot;</span><span class="p">,</span> <span class="s2">&quot;direct&quot;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">http</span><span class="p">:</span> <span class="n">DownloadConfiguration</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="n">DownloadConfiguration</span>
    <span class="p">)</span>
    <span class="n">validation</span><span class="p">:</span> <span class="n">ValidationConfig</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="n">ValidationConfig</span>
    <span class="p">)</span>
    <span class="n">logging</span><span class="p">:</span> <span class="n">LoggingConfiguration</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="n">LoggingConfiguration</span>
    <span class="p">)</span>
    <span class="n">continue_on_error</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">model_config</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;frozen&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s2">&quot;validate_assignment&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">}</span>
</pre></div>
</div>
<p><strong>Implementation</strong> for ResolvedConfig:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">ResolvedConfig</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Container for merged configuration defaults and fetch specifications.&quot;&quot;&quot;</span>

    <span class="n">defaults</span><span class="p">:</span> <span class="n">DefaultsConfig</span>
    <span class="n">specs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="s2">&quot;FetchSpec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_defaults</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ResolvedConfig&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create empty resolved configuration with library defaults.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">defaults</span><span class="o">=</span><span class="n">DefaultsConfig</span><span class="p">(),</span> <span class="n">specs</span><span class="o">=</span><span class="p">[])</span>

    <span class="n">model_config</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;frozen&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s2">&quot;validate_assignment&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s2">&quot;arbitrary_types_allowed&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>  <span class="c1"># Allow FetchSpec which may not be Pydantic</span>
    <span class="p">}</span>
</pre></div>
</div>
<p><strong>Acceptance Criteria</strong>:</p>
<ul class="simple">
<li><p>[x] Both classes converted</p></li>
<li><p>[x] Nested models work (http, validation, logging)</p></li>
<li><p>[x] from_defaults() class method works</p></li>
<li><p>[x] Tests updated</p></li>
</ul>
</section>
<section id="remove-custom-yaml-fallback-parser">
<h4>1.4.7 Remove custom YAML fallback parser<a class="headerlink" href="#remove-custom-yaml-fallback-parser" title="Link to this heading"></a></h4>
<p><strong>Objective</strong>: Delete ~150 lines of custom parser code</p>
<p><strong>Files to Modify</strong>: <code class="docutils literal notranslate"><span class="pre">src/DocsToKG/OntologyDownload/config.py</span></code></p>
<p><strong>Implementation</strong>:</p>
<ol class="arabic simple">
<li><p>Remove lines 23-141 (entire custom YAML parser implementation)</p></li>
<li><p>Remove _parse_scalar, _peek_next, _safe_load, _FallbackYAML</p></li>
<li><p>Keep try/except for yaml import but remove fallback:</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">yaml</span>
<span class="k">except</span> <span class="ne">ModuleNotFoundError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span>
        <span class="s2">&quot;PyYAML is required for configuration parsing. &quot;</span>
        <span class="s2">&quot;Install it with: pip install pyyaml&quot;</span>
    <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">exc</span>
</pre></div>
</div>
<p><strong>Acceptance Criteria</strong>:</p>
<ul class="simple">
<li><p>[x] Lines 23-141 deleted (~120 lines removed)</p></li>
<li><p>[x] yaml.safe_load is only YAML parser used</p></li>
<li><p>[x] Clear error if PyYAML not installed</p></li>
<li><p>[x] Tests pass</p></li>
</ul>
</section>
<section id="update-build-resolved-config-to-use-pydantic-model-validate">
<h4>1.4.8 Update <code class="docutils literal notranslate"><span class="pre">build_resolved_config()</span></code> to use Pydantic model_validate<a class="headerlink" href="#update-build-resolved-config-to-use-pydantic-model-validate" title="Link to this heading"></a></h4>
<p><strong>Objective</strong>: Use Pydantic validation instead of manual parsing</p>
<p><strong>Implementation</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">build_resolved_config</span><span class="p">(</span><span class="n">raw_config</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">object</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">ResolvedConfig</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Construct fully-resolved configuration from raw YAML contents.</span>

<span class="sd">    Args:</span>
<span class="sd">        raw_config: Mapping from YAML parsing</span>

<span class="sd">    Returns:</span>
<span class="sd">        ResolvedConfig with validated defaults and fetch specs</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValidationError: If configuration violates schema</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Parse defaults section using Pydantic</span>
        <span class="n">defaults_section</span> <span class="o">=</span> <span class="n">raw_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;defaults&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="n">DefaultsConfig</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">defaults_section</span><span class="p">)</span>

        <span class="c1"># Apply environment variable overrides</span>
        <span class="n">_apply_env_overrides</span><span class="p">(</span><span class="n">defaults</span><span class="p">)</span>

        <span class="c1"># Parse ontologies section</span>
        <span class="n">ontologies</span> <span class="o">=</span> <span class="n">raw_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ontologies&quot;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ontologies</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ConfigError</span><span class="p">(</span><span class="s2">&quot;&#39;ontologies&#39; must be a list&quot;</span><span class="p">)</span>

        <span class="n">fetch_specs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">FetchSpec</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">entry</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ontologies</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">ConfigError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Ontology entry #</span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2"> must be a mapping&quot;</span><span class="p">)</span>
            <span class="n">fetch_specs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">merge_defaults</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">defaults</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">ResolvedConfig</span><span class="p">(</span><span class="n">defaults</span><span class="o">=</span><span class="n">defaults</span><span class="p">,</span> <span class="n">specs</span><span class="o">=</span><span class="n">fetch_specs</span><span class="p">)</span>

    <span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="c1"># Convert Pydantic ValidationError to ConfigError with clear message</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="n">exc</span><span class="o">.</span><span class="n">errors</span><span class="p">()</span>
        <span class="n">messages</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">errors</span><span class="p">:</span>
            <span class="n">loc</span> <span class="o">=</span> <span class="s2">&quot; -&gt; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">error</span><span class="p">[</span><span class="s2">&quot;loc&quot;</span><span class="p">])</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">error</span><span class="p">[</span><span class="s2">&quot;msg&quot;</span><span class="p">]</span>
            <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">loc</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">ConfigError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Configuration validation failed:</span><span class="se">\n</span><span class="s2">  &quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">messages</span><span class="p">))</span> <span class="kn">from</span><span class="w"> </span><span class="nn">exc</span>
</pre></div>
</div>
<p><strong>Acceptance Criteria</strong>:</p>
<ul class="simple">
<li><p>[x] Uses DefaultsConfig.model_validate()</p></li>
<li><p>[x] Catches ValidationError and converts to ConfigError</p></li>
<li><p>[x] Clear error messages with field locations</p></li>
<li><p>[x] Tests pass</p></li>
</ul>
</section>
<section id="implement-pydantic-field-validators-for-config-constraints">
<h4>1.4.9 Implement Pydantic field validators for config constraints<a class="headerlink" href="#implement-pydantic-field-validators-for-config-constraints" title="Link to this heading"></a></h4>
<p><strong>Objective</strong>: Add validators for complex constraints</p>
<p><strong>Implementation</strong>: Already covered in 1.4.2-1.4.4 with &#64;field_validator decorators</p>
<p><strong>Additional Validators</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># In DefaultsConfig</span>
<span class="nd">@field_validator</span><span class="p">(</span><span class="s1">&#39;prefer_source&#39;</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_prefer_source</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate resolver names are recognized.&quot;&quot;&quot;</span>
    <span class="n">valid_resolvers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;obo&quot;</span><span class="p">,</span> <span class="s2">&quot;bioregistry&quot;</span><span class="p">,</span> <span class="s2">&quot;ols&quot;</span><span class="p">,</span> <span class="s2">&quot;bioportal&quot;</span><span class="p">,</span> <span class="s2">&quot;skos&quot;</span><span class="p">,</span> <span class="s2">&quot;xbrl&quot;</span><span class="p">,</span> <span class="s2">&quot;lov&quot;</span><span class="p">,</span> <span class="s2">&quot;ontobee&quot;</span><span class="p">,</span> <span class="s2">&quot;direct&quot;</span><span class="p">}</span>
    <span class="k">for</span> <span class="n">resolver</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">resolver</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_resolvers</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown resolver &#39;</span><span class="si">{</span><span class="n">resolver</span><span class="si">}</span><span class="s2">&#39;. Valid: </span><span class="si">{</span><span class="n">valid_resolvers</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">v</span>
</pre></div>
</div>
<p><strong>Acceptance Criteria</strong>:</p>
<ul class="simple">
<li><p>[x] Validators added for critical fields</p></li>
<li><p>[x] Tests cover validation failures</p></li>
<li><p>[x] Error messages are actionable</p></li>
</ul>
</section>
<section id="update-environment-variable-merging-to-use-pydantic-settings">
<h4>1.4.10 Update environment variable merging to use Pydantic settings<a class="headerlink" href="#update-environment-variable-merging-to-use-pydantic-settings" title="Link to this heading"></a></h4>
<p><strong>Objective</strong>: Use Pydantic Settings for env var handling</p>
<p><strong>Implementation</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseSettings</span><span class="p">,</span> <span class="n">SettingsConfigDict</span>

<span class="k">class</span><span class="w"> </span><span class="nc">EnvironmentOverrides</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Environment variable overrides for ontology downloader.&quot;&quot;&quot;</span>

    <span class="n">max_retries</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alias</span><span class="o">=</span><span class="s2">&quot;ONTOFETCH_MAX_RETRIES&quot;</span><span class="p">)</span>
    <span class="n">timeout_sec</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alias</span><span class="o">=</span><span class="s2">&quot;ONTOFETCH_TIMEOUT_SEC&quot;</span><span class="p">)</span>
    <span class="n">download_timeout_sec</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alias</span><span class="o">=</span><span class="s2">&quot;ONTOFETCH_DOWNLOAD_TIMEOUT_SEC&quot;</span><span class="p">)</span>
    <span class="n">per_host_rate_limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alias</span><span class="o">=</span><span class="s2">&quot;ONTOFETCH_PER_HOST_RATE_LIMIT&quot;</span><span class="p">)</span>
    <span class="n">backoff_factor</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alias</span><span class="o">=</span><span class="s2">&quot;ONTOFETCH_BACKOFF_FACTOR&quot;</span><span class="p">)</span>
    <span class="n">log_level</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alias</span><span class="o">=</span><span class="s2">&quot;ONTOFETCH_LOG_LEVEL&quot;</span><span class="p">)</span>

    <span class="n">model_config</span> <span class="o">=</span> <span class="n">SettingsConfigDict</span><span class="p">(</span>
        <span class="n">env_prefix</span><span class="o">=</span><span class="s2">&quot;ONTOFETCH_&quot;</span><span class="p">,</span>
        <span class="n">case_sensitive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">extra</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span>
    <span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">_apply_env_overrides</span><span class="p">(</span><span class="n">defaults</span><span class="p">:</span> <span class="n">DefaultsConfig</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Apply environment variable overrides to defaults.</span>

<span class="sd">    Args:</span>
<span class="sd">        defaults: DefaultsConfig to modify in-place</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">EnvironmentOverrides</span><span class="p">()</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;DocsToKG.OntologyDownload&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">env</span><span class="o">.</span><span class="n">max_retries</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">defaults</span><span class="o">.</span><span class="n">http</span><span class="o">.</span><span class="n">max_retries</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">max_retries</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Config overridden: max_retries=</span><span class="si">{</span><span class="n">env</span><span class="o">.</span><span class="n">max_retries</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;stage&quot;</span><span class="p">:</span> <span class="s2">&quot;config&quot;</span><span class="p">})</span>

    <span class="k">if</span> <span class="n">env</span><span class="o">.</span><span class="n">timeout_sec</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">defaults</span><span class="o">.</span><span class="n">http</span><span class="o">.</span><span class="n">timeout_sec</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">timeout_sec</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Config overridden: timeout_sec=</span><span class="si">{</span><span class="n">env</span><span class="o">.</span><span class="n">timeout_sec</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;stage&quot;</span><span class="p">:</span> <span class="s2">&quot;config&quot;</span><span class="p">})</span>

    <span class="c1"># ... similar for other fields</span>
</pre></div>
</div>
<p><strong>Acceptance Criteria</strong>:</p>
<ul class="simple">
<li><p>[x] EnvironmentOverrides class created</p></li>
<li><p>[x] _apply_env_overrides uses Pydantic settings</p></li>
<li><p>[x] Tests verify env vars override config file</p></li>
<li><p>[x] Logging shows which overrides applied</p></li>
</ul>
</section>
<section id="update-all-config-tests-to-work-with-pydantic-models">
<h4>1.4.11 Update all config tests to work with Pydantic models<a class="headerlink" href="#update-all-config-tests-to-work-with-pydantic-models" title="Link to this heading"></a></h4>
<p><strong>Objective</strong>: Fix tests broken by Pydantic migration</p>
<p><strong>Implementation</strong>:</p>
<ul class="simple">
<li><p>Update test fixtures to create Pydantic models</p></li>
<li><p>Change assertions for ValidationError instead of ConfigError for validation failures</p></li>
<li><p>Add tests for Pydantic-specific features (model_validate, model_dump, model_json_schema)</p></li>
</ul>
<p><strong>Example Test Updates</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_defaults_config_pydantic</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test DefaultsConfig is Pydantic model.&quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span>
    <span class="k">assert</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">DefaultsConfig</span><span class="p">,</span> <span class="n">BaseModel</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">test_defaults_config_json_schema</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test JSON schema generation.&quot;&quot;&quot;</span>
    <span class="n">schema</span> <span class="o">=</span> <span class="n">DefaultsConfig</span><span class="o">.</span><span class="n">model_json_schema</span><span class="p">()</span>
    <span class="k">assert</span> <span class="s2">&quot;properties&quot;</span> <span class="ow">in</span> <span class="n">schema</span>
    <span class="k">assert</span> <span class="s2">&quot;accept_licenses&quot;</span> <span class="ow">in</span> <span class="n">schema</span><span class="p">[</span><span class="s2">&quot;properties&quot;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">schema</span><span class="p">[</span><span class="s2">&quot;properties&quot;</span><span class="p">][</span><span class="s2">&quot;accept_licenses&quot;</span><span class="p">][</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;array&quot;</span>


<span class="k">def</span><span class="w"> </span><span class="nf">test_download_config_validation_error</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test Pydantic ValidationError for invalid values.&quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">ValidationError</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">)</span> <span class="k">as</span> <span class="n">exc_info</span><span class="p">:</span>
        <span class="n">DownloadConfiguration</span><span class="p">(</span><span class="n">max_retries</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="n">exc_info</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">errors</span><span class="p">()</span>
    <span class="k">assert</span> <span class="nb">any</span><span class="p">(</span><span class="s2">&quot;greater than or equal to 0&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">errors</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Acceptance Criteria</strong>:</p>
<ul class="simple">
<li><p>[x] All config tests pass</p></li>
<li><p>[x] Tests use ValidationError where appropriate</p></li>
<li><p>[x] New tests for Pydantic features</p></li>
<li><p>[x] Coverage maintained &gt;85%</p></li>
</ul>
</section>
<section id="verify-json-schema-generation-works-for-documentation">
<h4>1.4.12 Verify JSON Schema generation works for documentation<a class="headerlink" href="#verify-json-schema-generation-works-for-documentation" title="Link to this heading"></a></h4>
<p><strong>Objective</strong>: Generate and validate JSON Schema</p>
<p><strong>Implementation</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Script: scripts/generate_config_schema.py</span>
<span class="sd">&quot;&quot;&quot;Generate JSON Schema for configuration documentation.&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">DocsToKG.OntologyDownload.config</span><span class="w"> </span><span class="kn">import</span> <span class="n">ResolvedConfig</span>

<span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="n">schema</span> <span class="o">=</span> <span class="n">ResolvedConfig</span><span class="o">.</span><span class="n">model_json_schema</span><span class="p">()</span>

    <span class="c1"># Add metadata</span>
    <span class="n">schema</span><span class="p">[</span><span class="s2">&quot;$schema&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;https://json-schema.org/draft/2020-12/schema&quot;</span>
    <span class="n">schema</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Ontology Downloader Configuration&quot;</span>
    <span class="n">schema</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Schema for DocsToKG ontology downloader sources.yaml&quot;</span>

    <span class="c1"># Write to docs</span>
    <span class="n">output_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;docs/schemas/ontology-downloader-config.json&quot;</span><span class="p">)</span>
    <span class="n">output_path</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">output_path</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">schema</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Schema written to </span><span class="si">{</span><span class="n">output_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Schema has </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">schema</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;properties&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{}))</span><span class="si">}</span><span class="s2"> root properties&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<p><strong>Test Schema</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generate schema</span>
python<span class="w"> </span>scripts/generate_config_schema.py

<span class="c1"># Validate schema is valid JSON Schema</span>
pip<span class="w"> </span>install<span class="w"> </span>check-jsonschema
check-jsonschema<span class="w"> </span>--check-metaschema<span class="w"> </span>docs/schemas/ontology-downloader-config.json

<span class="c1"># Validate example sources.yaml against schema</span>
check-jsonschema<span class="w"> </span>--schemafile<span class="w"> </span>docs/schemas/ontology-downloader-config.json<span class="w"> </span>docs/examples/sources.yaml
</pre></div>
</div>
<p><strong>Acceptance Criteria</strong>:</p>
<ul class="simple">
<li><p>[x] JSON Schema generates successfully</p></li>
<li><p>[x] Schema validates as valid JSON Schema</p></li>
<li><p>[x] Example sources.yaml validates against schema</p></li>
<li><p>[x] Schema documented in docs/</p></li>
</ul>
</section>
</section>
</section>
<hr class="docutils" />
<section id="robustness-download-and-security-enhancements">
<h2>2. Robustness: Download and Security Enhancements<a class="headerlink" href="#robustness-download-and-security-enhancements" title="Link to this heading"></a></h2>
<section id="implement-head-request-with-media-type-validation">
<h3>2.1 Implement HEAD Request with Media Type Validation<a class="headerlink" href="#implement-head-request-with-media-type-validation" title="Link to this heading"></a></h3>
<section id="add-preliminary-head-check-method-to-streamingdownloader-class">
<h4>2.1.1 Add <code class="docutils literal notranslate"><span class="pre">_preliminary_head_check()</span></code> method to <code class="docutils literal notranslate"><span class="pre">StreamingDownloader</span></code> class<a class="headerlink" href="#add-preliminary-head-check-method-to-streamingdownloader-class" title="Link to this heading"></a></h4>
<p><strong>Objective</strong>: Perform HEAD request before full GET</p>
<p><strong>Files to Modify</strong>: <code class="docutils literal notranslate"><span class="pre">src/DocsToKG/OntologyDownload/download.py</span></code></p>
<p><strong>Implementation</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add to StreamingDownloader class around line 300</span>

<span class="k">def</span><span class="w"> </span><span class="nf">_preliminary_head_check</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">session</span><span class="p">:</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Perform HEAD request to validate media type and get content length.</span>

<span class="sd">    Args:</span>
<span class="sd">        url: Target URL to check</span>
<span class="sd">        session: Requests session to use</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple of (content_type, content_length) or (None, None) if HEAD fails</span>

<span class="sd">    Raises:</span>
<span class="sd">        ConfigError: If content exceeds size limit</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">head_response</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">head</span><span class="p">(</span>
            <span class="n">url</span><span class="p">,</span>
            <span class="n">headers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">custom_headers</span><span class="p">,</span>
            <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">http_config</span><span class="o">.</span><span class="n">timeout_sec</span><span class="p">,</span>
            <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

        <span class="c1"># HEAD request allowed to fail gracefully (some servers don&#39;t support it)</span>
        <span class="k">if</span> <span class="n">head_response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">&gt;=</span> <span class="mi">400</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="s2">&quot;HEAD request failed, proceeding with GET&quot;</span><span class="p">,</span>
                <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;stage&quot;</span><span class="p">:</span> <span class="s2">&quot;download&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;HEAD&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;status_code&quot;</span><span class="p">:</span> <span class="n">head_response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span>
                    <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">url</span>
                <span class="p">}</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

        <span class="n">content_type</span> <span class="o">=</span> <span class="n">head_response</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">)</span>
        <span class="n">content_length_str</span> <span class="o">=</span> <span class="n">head_response</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Content-Length&quot;</span><span class="p">)</span>
        <span class="n">content_length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">content_length_str</span><span class="p">)</span> <span class="k">if</span> <span class="n">content_length_str</span> <span class="k">else</span> <span class="kc">None</span>

        <span class="c1"># Check size early</span>
        <span class="k">if</span> <span class="n">content_length</span><span class="p">:</span>
            <span class="n">max_bytes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">http_config</span><span class="o">.</span><span class="n">max_download_size_gb</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1024</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">content_length</span> <span class="o">&gt;</span> <span class="n">max_bytes</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="s2">&quot;file exceeds size limit (HEAD check)&quot;</span><span class="p">,</span>
                    <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
                        <span class="s2">&quot;stage&quot;</span><span class="p">:</span> <span class="s2">&quot;download&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;content_length&quot;</span><span class="p">:</span> <span class="n">content_length</span><span class="p">,</span>
                        <span class="s2">&quot;limit_bytes&quot;</span><span class="p">:</span> <span class="n">max_bytes</span><span class="p">,</span>
                        <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">url</span>
                    <span class="p">}</span>
                <span class="p">)</span>
                <span class="k">raise</span> <span class="n">ConfigError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;File size </span><span class="si">{</span><span class="n">content_length</span><span class="si">}</span><span class="s2"> bytes exceeds limit of &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">http_config</span><span class="o">.</span><span class="n">max_download_size_gb</span><span class="si">}</span><span class="s2"> GB (detected via HEAD)&quot;</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="n">content_type</span><span class="p">,</span> <span class="n">content_length</span>

    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="c1"># HEAD request failures are non-fatal</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;HEAD request exception, proceeding with GET&quot;</span><span class="p">,</span>
            <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;stage&quot;</span><span class="p">:</span> <span class="s2">&quot;download&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">),</span> <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">url</span><span class="p">}</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</pre></div>
</div>
<p><strong>Acceptance Criteria</strong>:</p>
<ul class="simple">
<li><p>[x] Method added to StreamingDownloader</p></li>
<li><p>[x] Returns content_type and content_length tuple</p></li>
<li><p>[x] Raises ConfigError if size exceeds limit</p></li>
<li><p>[x] Logs HEAD failures at debug level</p></li>
<li><p>[x] Non-fatal if HEAD not supported</p></li>
</ul>
</section>
<section id="implement-content-type-header-extraction-and-validation">
<h4>2.1.2 Implement Content-Type header extraction and validation<a class="headerlink" href="#implement-content-type-header-extraction-and-validation" title="Link to this heading"></a></h4>
<p><strong>Objective</strong>: Validate media type matches expected</p>
<p><strong>Implementation</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add to StreamingDownloader class</span>

<span class="k">def</span><span class="w"> </span><span class="nf">_validate_media_type</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">actual_content_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">expected_media_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate actual Content-Type matches expected media type.</span>

<span class="sd">    Args:</span>
<span class="sd">        actual_content_type: Content-Type from HTTP response</span>
<span class="sd">        expected_media_type: Expected media type from FetchPlan</span>

<span class="sd">    Raises:</span>
<span class="sd">        ConfigError: If validation enabled and types mismatch severely</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Skip if validation disabled</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">http_config</span><span class="o">.</span><span class="n">validate_media_type</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="c1"># Skip if no expected type specified</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">expected_media_type</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="c1"># Skip if server didn&#39;t provide Content-Type</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">actual_content_type</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="s2">&quot;server did not provide Content-Type header&quot;</span><span class="p">,</span>
            <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;stage&quot;</span><span class="p">:</span> <span class="s2">&quot;download&quot;</span><span class="p">,</span> <span class="s2">&quot;expected_media_type&quot;</span><span class="p">:</span> <span class="n">expected_media_type</span><span class="p">}</span>
        <span class="p">)</span>
        <span class="k">return</span>

    <span class="c1"># Parse Content-Type to remove charset, boundary, etc.</span>
    <span class="n">actual_mime</span> <span class="o">=</span> <span class="n">actual_content_type</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">expected_mime</span> <span class="o">=</span> <span class="n">expected_media_type</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">actual_mime</span> <span class="o">!=</span> <span class="n">expected_mime</span><span class="p">:</span>
        <span class="c1"># Check for acceptable variations</span>
        <span class="n">acceptable_variations</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;application/rdf+xml&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;application/xml&quot;</span><span class="p">,</span> <span class="s2">&quot;text/xml&quot;</span><span class="p">},</span>
            <span class="s2">&quot;text/turtle&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;text/plain&quot;</span><span class="p">,</span> <span class="s2">&quot;application/x-turtle&quot;</span><span class="p">},</span>
            <span class="s2">&quot;application/owl+xml&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;application/xml&quot;</span><span class="p">,</span> <span class="s2">&quot;text/xml&quot;</span><span class="p">},</span>
        <span class="p">}</span>

        <span class="n">acceptable</span> <span class="o">=</span> <span class="n">acceptable_variations</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">expected_mime</span><span class="p">,</span> <span class="nb">set</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">actual_mime</span> <span class="ow">in</span> <span class="n">acceptable</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;acceptable media type variation&quot;</span><span class="p">,</span>
                <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;stage&quot;</span><span class="p">:</span> <span class="s2">&quot;download&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;expected&quot;</span><span class="p">:</span> <span class="n">expected_mime</span><span class="p">,</span>
                    <span class="s2">&quot;actual&quot;</span><span class="p">:</span> <span class="n">actual_mime</span>
                <span class="p">}</span>
            <span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Log warning for mismatch</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="s2">&quot;media type mismatch&quot;</span><span class="p">,</span>
            <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;stage&quot;</span><span class="p">:</span> <span class="s2">&quot;download&quot;</span><span class="p">,</span>
                <span class="s2">&quot;expected_media_type&quot;</span><span class="p">:</span> <span class="n">expected_mime</span><span class="p">,</span>
                <span class="s2">&quot;actual_media_type&quot;</span><span class="p">:</span> <span class="n">actual_mime</span><span class="p">,</span>
                <span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;proceeding with download&quot;</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="c1"># Could add strict mode that raises ConfigError here:</span>
        <span class="c1"># if self.http_config.strict_media_type_validation:</span>
        <span class="c1">#     raise ConfigError(f&quot;Media type mismatch: expected {expected_mime}, got {actual_mime}&quot;)</span>
</pre></div>
</div>
<p><strong>Acceptance Criteria</strong>:</p>
<ul class="simple">
<li><p>[x] Validates Content-Type against expected</p></li>
<li><p>[x] Handles acceptable variations (XML types)</p></li>
<li><p>[x] Logs warnings for mismatches</p></li>
<li><p>[x] Configurable via validate_media_type flag</p></li>
</ul>
</section>
<section id="implement-early-content-length-check-against-size-limits">
<h4>2.1.3 Implement early Content-Length check against size limits<a class="headerlink" href="#implement-early-content-length-check-against-size-limits" title="Link to this heading"></a></h4>
<p><strong>Objective</strong>: Fail fast if file too large</p>
<p><strong>Implementation</strong>: Already covered in 2.1.1 within <code class="docutils literal notranslate"><span class="pre">_preliminary_head_check()</span></code></p>
<p><strong>Additional Test</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_head_check_rejects_oversized_file</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test HEAD check raises ConfigError for file exceeding limit.&quot;&quot;&quot;</span>
    <span class="c1"># Setup: mock HEAD response with Content-Length &gt; max_download_size_gb</span>
    <span class="c1"># Test: call _preliminary_head_check()</span>
    <span class="c1"># Assert: raises ConfigError with size info</span>
</pre></div>
</div>
<p><strong>Acceptance Criteria</strong>:</p>
<ul class="simple">
<li><p>[x] Raises ConfigError if Content-Length &gt; limit</p></li>
<li><p>[x] Error message includes size and limit</p></li>
<li><p>[x] Works before starting GET request</p></li>
</ul>
</section>
<section id="add-config-flag-http-validate-media-type-default-true">
<h4>2.1.4 Add config flag <code class="docutils literal notranslate"><span class="pre">http.validate_media_type</span></code> (default: true)<a class="headerlink" href="#add-config-flag-http-validate-media-type-default-true" title="Link to this heading"></a></h4>
<p><strong>Objective</strong>: Make validation optional</p>
<p><strong>Implementation</strong>: Already added in 1.4.4 to DownloadConfiguration:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">validate_media_type</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Configuration Example</strong>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># sources.yaml</span>
<span class="nt">defaults</span><span class="p">:</span>
<span class="w">  </span><span class="nt">http</span><span class="p">:</span>
<span class="w">    </span><span class="nt">validate_media_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">  </span><span class="c1"># Enable HEAD request validation (default)</span>
<span class="w">    </span><span class="c1"># Set to false to skip Content-Type checking</span>
</pre></div>
</div>
<p><strong>Acceptance Criteria</strong>:</p>
<ul class="simple">
<li><p>[x] Field added to DownloadConfiguration</p></li>
<li><p>[x] Defaults to True</p></li>
<li><p>[x] Can be set False in config</p></li>
<li><p>[x] Documented in example sources.yaml</p></li>
</ul>
</section>
<section id="log-warnings-for-media-type-mismatches-with-override-instructions">
<h4>2.1.5 Log warnings for media-type mismatches with override instructions<a class="headerlink" href="#log-warnings-for-media-type-mismatches-with-override-instructions" title="Link to this heading"></a></h4>
<p><strong>Objective</strong>: Provide actionable guidance when types don’t match</p>
<p><strong>Implementation</strong>: Already in 2.1.2, enhance logging:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="s2">&quot;media type mismatch detected&quot;</span><span class="p">,</span>
            <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;stage&quot;</span><span class="p">:</span> <span class="s2">&quot;download&quot;</span><span class="p">,</span>
                <span class="s2">&quot;expected_media_type&quot;</span><span class="p">:</span> <span class="n">expected_mime</span><span class="p">,</span>
                <span class="s2">&quot;actual_media_type&quot;</span><span class="p">:</span> <span class="n">actual_mime</span><span class="p">,</span>
                <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span>
                <span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;proceeding with download&quot;</span><span class="p">,</span>
                <span class="s2">&quot;override_hint&quot;</span><span class="p">:</span> <span class="s2">&quot;Set defaults.http.validate_media_type: false to disable validation&quot;</span>
            <span class="p">}</span>
        <span class="p">)</span>
</pre></div>
</div>
<p><strong>Acceptance Criteria</strong>:</p>
<ul class="simple">
<li><p>[x] Warning logged with both types</p></li>
<li><p>[x] Hint provided for disabling validation</p></li>
<li><p>[x] URL included for troubleshooting</p></li>
</ul>
</section>
<section id="add-tests-for-head-request-success-failure-and-mismatch-scenarios">
<h4>2.1.6 Add tests for HEAD request success, failure, and mismatch scenarios<a class="headerlink" href="#add-tests-for-head-request-success-failure-and-mismatch-scenarios" title="Link to this heading"></a></h4>
<p><strong>Objective</strong>: Comprehensive test coverage for HEAD validation</p>
<p><strong>Files to Create/Modify</strong>: <code class="docutils literal notranslate"><span class="pre">tests/ontology_download/test_download.py</span></code></p>
<p><strong>Implementation</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">test_head_check_success_returns_metadata</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test successful HEAD request returns content type and length.&quot;&quot;&quot;</span>
    <span class="c1"># Setup: mock HEAD response with Content-Type and Content-Length</span>
    <span class="k">with</span> <span class="n">requests_mock</span><span class="o">.</span><span class="n">Mocker</span><span class="p">()</span> <span class="k">as</span> <span class="n">m</span><span class="p">:</span>
        <span class="n">m</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="s2">&quot;https://example.org/ont.owl&quot;</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/rdf+xml&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Content-Length&quot;</span><span class="p">:</span> <span class="s2">&quot;1024&quot;</span>
        <span class="p">})</span>

        <span class="n">downloader</span> <span class="o">=</span> <span class="n">StreamingDownloader</span><span class="p">(</span>
            <span class="n">destination</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;test.owl&quot;</span><span class="p">),</span>
            <span class="n">headers</span><span class="o">=</span><span class="p">{},</span>
            <span class="n">http_config</span><span class="o">=</span><span class="n">DownloadConfiguration</span><span class="p">(),</span>
            <span class="n">previous_manifest</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">logger</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">content_type</span><span class="p">,</span> <span class="n">content_length</span> <span class="o">=</span> <span class="n">downloader</span><span class="o">.</span><span class="n">_preliminary_head_check</span><span class="p">(</span>
            <span class="s2">&quot;https://example.org/ont.owl&quot;</span><span class="p">,</span>
            <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="k">assert</span> <span class="n">content_type</span> <span class="o">==</span> <span class="s2">&quot;application/rdf+xml&quot;</span>
        <span class="k">assert</span> <span class="n">content_length</span> <span class="o">==</span> <span class="mi">1024</span>


<span class="k">def</span><span class="w"> </span><span class="nf">test_head_check_graceful_on_405</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test HEAD check handles 405 Method Not Allowed gracefully.&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">requests_mock</span><span class="o">.</span><span class="n">Mocker</span><span class="p">()</span> <span class="k">as</span> <span class="n">m</span><span class="p">:</span>
        <span class="n">m</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="s2">&quot;https://example.org/ont.owl&quot;</span><span class="p">,</span> <span class="n">status_code</span><span class="o">=</span><span class="mi">405</span><span class="p">)</span>

        <span class="n">downloader</span> <span class="o">=</span> <span class="n">StreamingDownloader</span><span class="p">(</span>
            <span class="n">destination</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;test.owl&quot;</span><span class="p">),</span>
            <span class="n">headers</span><span class="o">=</span><span class="p">{},</span>
            <span class="n">http_config</span><span class="o">=</span><span class="n">DownloadConfiguration</span><span class="p">(),</span>
            <span class="n">previous_manifest</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">logger</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">content_type</span><span class="p">,</span> <span class="n">content_length</span> <span class="o">=</span> <span class="n">downloader</span><span class="o">.</span><span class="n">_preliminary_head_check</span><span class="p">(</span>
            <span class="s2">&quot;https://example.org/ont.owl&quot;</span><span class="p">,</span>
            <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="c1"># Should return None, None and not raise</span>
        <span class="k">assert</span> <span class="n">content_type</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="k">assert</span> <span class="n">content_length</span> <span class="ow">is</span> <span class="kc">None</span>


<span class="k">def</span><span class="w"> </span><span class="nf">test_head_check_raises_on_oversized</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test HEAD check raises ConfigError for file exceeding size limit.&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">requests_mock</span><span class="o">.</span><span class="n">Mocker</span><span class="p">()</span> <span class="k">as</span> <span class="n">m</span><span class="p">:</span>
        <span class="c1"># 6GB file when limit is 5GB</span>
        <span class="n">m</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="s2">&quot;https://example.org/huge.owl&quot;</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;Content-Length&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="mi">6</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">)</span>
        <span class="p">})</span>

        <span class="n">downloader</span> <span class="o">=</span> <span class="n">StreamingDownloader</span><span class="p">(</span>
            <span class="n">destination</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;test.owl&quot;</span><span class="p">),</span>
            <span class="n">headers</span><span class="o">=</span><span class="p">{},</span>
            <span class="n">http_config</span><span class="o">=</span><span class="n">DownloadConfiguration</span><span class="p">(</span><span class="n">max_download_size_gb</span><span class="o">=</span><span class="mf">5.0</span><span class="p">),</span>
            <span class="n">previous_manifest</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">logger</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">ConfigError</span><span class="p">)</span> <span class="k">as</span> <span class="n">exc_info</span><span class="p">:</span>
            <span class="n">downloader</span><span class="o">.</span><span class="n">_preliminary_head_check</span><span class="p">(</span>
                <span class="s2">&quot;https://example.org/huge.owl&quot;</span><span class="p">,</span>
                <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
            <span class="p">)</span>

        <span class="k">assert</span> <span class="s2">&quot;exceeds limit&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc_info</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">test_validate_media_type_match</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test media type validation passes on exact match.&quot;&quot;&quot;</span>
    <span class="n">downloader</span> <span class="o">=</span> <span class="n">StreamingDownloader</span><span class="p">(</span>
        <span class="n">destination</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;test.owl&quot;</span><span class="p">),</span>
        <span class="n">headers</span><span class="o">=</span><span class="p">{},</span>
        <span class="n">http_config</span><span class="o">=</span><span class="n">DownloadConfiguration</span><span class="p">(</span><span class="n">validate_media_type</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="n">previous_manifest</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">logger</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># Should not raise or log warning</span>
    <span class="n">downloader</span><span class="o">.</span><span class="n">_validate_media_type</span><span class="p">(</span>
        <span class="s2">&quot;application/rdf+xml&quot;</span><span class="p">,</span>
        <span class="s2">&quot;application/rdf+xml&quot;</span>
    <span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">test_validate_media_type_acceptable_variation</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test validation accepts known variations.&quot;&quot;&quot;</span>
    <span class="n">downloader</span> <span class="o">=</span> <span class="n">StreamingDownloader</span><span class="p">(</span>
        <span class="n">destination</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;test.owl&quot;</span><span class="p">),</span>
        <span class="n">headers</span><span class="o">=</span><span class="p">{},</span>
        <span class="n">http_config</span><span class="o">=</span><span class="n">DownloadConfiguration</span><span class="p">(</span><span class="n">validate_media_type</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="n">previous_manifest</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">logger</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># application/xml is acceptable for application/rdf+xml</span>
    <span class="n">downloader</span><span class="o">.</span><span class="n">_validate_media_type</span><span class="p">(</span>
        <span class="s2">&quot;application/xml&quot;</span><span class="p">,</span>
        <span class="s2">&quot;application/rdf+xml&quot;</span>
    <span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">test_validate_media_type_mismatch_logs_warning</span><span class="p">(</span><span class="n">caplog</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test media type mismatch logs warning.&quot;&quot;&quot;</span>
    <span class="n">downloader</span> <span class="o">=</span> <span class="n">StreamingDownloader</span><span class="p">(</span>
        <span class="n">destination</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;test.owl&quot;</span><span class="p">),</span>
        <span class="n">headers</span><span class="o">=</span><span class="p">{},</span>
        <span class="n">http_config</span><span class="o">=</span><span class="n">DownloadConfiguration</span><span class="p">(</span><span class="n">validate_media_type</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="n">previous_manifest</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">logger</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="k">with</span> <span class="n">caplog</span><span class="o">.</span><span class="n">at_level</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">):</span>
        <span class="n">downloader</span><span class="o">.</span><span class="n">_validate_media_type</span><span class="p">(</span>
            <span class="s2">&quot;text/html&quot;</span><span class="p">,</span>  <span class="c1"># Wrong type</span>
            <span class="s2">&quot;application/rdf+xml&quot;</span>
        <span class="p">)</span>

    <span class="k">assert</span> <span class="s2">&quot;mismatch&quot;</span> <span class="ow">in</span> <span class="n">caplog</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>


<span class="k">def</span><span class="w"> </span><span class="nf">test_validate_media_type_disabled</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test validation skipped when disabled.&quot;&quot;&quot;</span>
    <span class="n">downloader</span> <span class="o">=</span> <span class="n">StreamingDownloader</span><span class="p">(</span>
        <span class="n">destination</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;test.owl&quot;</span><span class="p">),</span>
        <span class="n">headers</span><span class="o">=</span><span class="p">{},</span>
        <span class="n">http_config</span><span class="o">=</span><span class="n">DownloadConfiguration</span><span class="p">(</span><span class="n">validate_media_type</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
        <span class="n">previous_manifest</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">logger</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># Should not log even with severe mismatch</span>
    <span class="n">downloader</span><span class="o">.</span><span class="n">_validate_media_type</span><span class="p">(</span>
        <span class="s2">&quot;text/plain&quot;</span><span class="p">,</span>
        <span class="s2">&quot;application/rdf+xml&quot;</span>
    <span class="p">)</span>
</pre></div>
</div>
<p><strong>Acceptance Criteria</strong>:</p>
<ul class="simple">
<li><p>[x] 7+ test cases covering HEAD scenarios</p></li>
<li><p>[x] Tests pass</p></li>
<li><p>[x] Coverage &gt;90% for new methods</p></li>
</ul>
</section>
</section>
<section id="implement-per-service-rate-limiting">
<h3>2.2 Implement Per-Service Rate Limiting<a class="headerlink" href="#implement-per-service-rate-limiting" title="Link to this heading"></a></h3>
<section id="propagate-service-identifiers-through-fetch-planning">
<h4>2.2.1 Propagate service identifiers through fetch planning<a class="headerlink" href="#propagate-service-identifiers-through-fetch-planning" title="Link to this heading"></a></h4>
<p><strong>Objective</strong>: Ensure resolvers and core download orchestration expose service metadata for rate limiting and logging.</p>
<p><strong>Implementation</strong>:</p>
<ul class="simple">
<li><p>Extend <code class="docutils literal notranslate"><span class="pre">FetchPlan</span></code> dataclass with an optional <code class="docutils literal notranslate"><span class="pre">service</span></code> field (string).</p></li>
<li><p>Update <code class="docutils literal notranslate"><span class="pre">BaseResolver._build_plan()</span></code> helper to accept <code class="docutils literal notranslate"><span class="pre">service</span></code> and forward it when instantiating <code class="docutils literal notranslate"><span class="pre">FetchPlan</span></code>.</p></li>
<li><p>Modify each resolver to populate <code class="docutils literal notranslate"><span class="pre">service=spec.resolver</span></code> (e.g., <code class="docutils literal notranslate"><span class="pre">obo</span></code>, <code class="docutils literal notranslate"><span class="pre">ols</span></code>, <code class="docutils literal notranslate"><span class="pre">bioportal</span></code>, <code class="docutils literal notranslate"><span class="pre">skos</span></code>, <code class="docutils literal notranslate"><span class="pre">xbrl</span></code>).</p></li>
<li><p>In <code class="docutils literal notranslate"><span class="pre">core.fetch_one()</span></code>, attach <code class="docutils literal notranslate"><span class="pre">plan.service</span></code> to the logger adapter extras and pass it into <code class="docutils literal notranslate"><span class="pre">download_stream()</span></code>.</p></li>
</ul>
<p><strong>Acceptance Criteria</strong>:</p>
<ul class="simple">
<li><p>[x] <code class="docutils literal notranslate"><span class="pre">FetchPlan</span></code> exposes a <code class="docutils literal notranslate"><span class="pre">service</span></code> attribute with docstring updates.</p></li>
<li><p>[x] All resolver implementations populate <code class="docutils literal notranslate"><span class="pre">service</span></code> consistently.</p></li>
<li><p>[x] <code class="docutils literal notranslate"><span class="pre">core.fetch_one()</span></code> includes <code class="docutils literal notranslate"><span class="pre">service</span></code> in logging context and download invocation.</p></li>
</ul>
</section>
<section id="add-per-service-token-bucket-selection">
<h4>2.2.2 Add per-service token bucket selection<a class="headerlink" href="#add-per-service-token-bucket-selection" title="Link to this heading"></a></h4>
<p><strong>Objective</strong>: Key rate limit buckets by service and host while respecting service-specific overrides.</p>
<p><strong>Implementation</strong>:</p>
<ul class="simple">
<li><p>Update <code class="docutils literal notranslate"><span class="pre">_get_bucket()</span></code> signature to accept optional <code class="docutils literal notranslate"><span class="pre">service</span></code> and construct cache keys as <code class="docutils literal notranslate"><span class="pre">&quot;service:host&quot;</span></code>.</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">DownloadConfiguration.parse_service_rate_limit()</span></code> to override the default per-host rate when available.</p></li>
<li><p>Ensure default per-host buckets remain functional when <code class="docutils literal notranslate"><span class="pre">service</span></code> is absent.</p></li>
<li><p>Reset or isolate <code class="docutils literal notranslate"><span class="pre">_TOKEN_BUCKETS</span></code> entries in unit tests to prevent leakage between scenarios.</p></li>
</ul>
<p><strong>Acceptance Criteria</strong>:</p>
<ul class="simple">
<li><p>[x] <code class="docutils literal notranslate"><span class="pre">_get_bucket()</span></code> caches buckets per service/host combination.</p></li>
<li><p>[x] Buckets fall back to <code class="docutils literal notranslate"><span class="pre">per_host_rate_limit</span></code> when no override exists.</p></li>
<li><p>[x] Unit tests cover service-specific, fallback, and host-only buckets.</p></li>
</ul>
</section>
<section id="document-and-test-per-service-rate-limiting">
<h4>2.2.3 Document and test per-service rate limiting<a class="headerlink" href="#document-and-test-per-service-rate-limiting" title="Link to this heading"></a></h4>
<p><strong>Objective</strong>: Update examples, API docs, and tests to reflect the new behaviour.</p>
<p><strong>Implementation</strong>:</p>
<ul class="simple">
<li><p>Add <code class="docutils literal notranslate"><span class="pre">rate_limits</span></code> examples for OLS and BioPortal in <code class="docutils literal notranslate"><span class="pre">docs/examples/sources.yaml</span></code>.</p></li>
<li><p>Expand API docs (<code class="docutils literal notranslate"><span class="pre">DocsToKG.OntologyDownload.download.md</span></code>, <code class="docutils literal notranslate"><span class="pre">DocsToKG.OntologyDownload.resolvers.md</span></code>) to describe service-aware rate limiting.</p></li>
<li><p>Add/extend unit tests in <code class="docutils literal notranslate"><span class="pre">tests/ontology_download/test_download.py</span></code>, <code class="docutils literal notranslate"><span class="pre">test_config.py</span></code>, and <code class="docutils literal notranslate"><span class="pre">test_integration.py</span></code> for the new service metadata.</p></li>
</ul>
<p><strong>Acceptance Criteria</strong>:</p>
<ul class="simple">
<li><p>[x] Example configuration demonstrates per-service overrides.</p></li>
<li><p>[x] API docs mention <code class="docutils literal notranslate"><span class="pre">service</span></code> usage in fetch plans and download rate limiting.</p></li>
<li><p>[x] New and existing tests pass validating per-service rate limiting.</p></li>
</ul>
</section>
</section>
</section>
<hr class="docutils" />
<section id="task-completion-tracking">
<h2>Task Completion Tracking<a class="headerlink" href="#task-completion-tracking" title="Link to this heading"></a></h2>
<p><strong>Foundation (1.1-1.4)</strong>: 27/52 tasks complete
<strong>Robustness Downloads (2.1-2.4)</strong>: 9/24 tasks complete
<strong>Robustness Validation (3.1-3.4)</strong>: 0/21 tasks complete
<strong>Capabilities (4.1-5.2)</strong>: 0/32 tasks complete
<strong>Storage (6.1)</strong>: 0/10 tasks complete
<strong>CLI (7.1-7.3)</strong>: 0/13 tasks complete
<strong>Testing (8.1-8.5)</strong>: 0/30 tasks complete
<strong>Deployment (9.1-9.3)</strong>: 0/13 tasks complete</p>
<p><strong>Total</strong>: 36/195 tasks complete (18.5%)</p>
</section>
<section id="notes-for-ai-programming-agents">
<h2>Notes for AI Programming Agents<a class="headerlink" href="#notes-for-ai-programming-agents" title="Link to this heading"></a></h2>
<ol class="arabic simple">
<li><p><strong>Work Sequentially</strong>: Complete tasks in numbered order; later tasks depend on earlier ones</p></li>
<li><p><strong>Test After Each Subtask</strong>: Run relevant tests after each implementation</p></li>
<li><p><strong>Commit Frequently</strong>: Commit working code after each major task (e.g., after 1.1, 1.2, etc.)</p></li>
<li><p><strong>Use Type Hints</strong>: All new code should have complete type annotations</p></li>
<li><p><strong>Follow Existing Patterns</strong>: Match coding style of surrounding code</p></li>
<li><p><strong>Update Tests</strong>: Every code change requires corresponding test updates</p></li>
<li><p><strong>Document as You Go</strong>: Add docstrings immediately, not as separate task</p></li>
<li><p><strong>Ask for Clarification</strong>: If any instruction is ambiguous, ask before implementing</p></li>
<li><p><strong>Verify Acceptance Criteria</strong>: Check off acceptance criteria as you complete each task</p></li>
<li><p><strong>Run Full Suite</strong>: Run complete test suite before marking phase complete</p></li>
</ol>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, DocsToKG Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.


</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

</body>
</html>
